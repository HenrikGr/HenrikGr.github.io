{"componentChunkName":"component---src-templates-article-page-template-js","path":"/articles/react-intersection-api/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Intersection API in React","subtitle":"Use intersection API to animate components","date":"2019-12-09","publishedBy":"Henrik Grönvall"},"excerpt":"As a web developer we knows how important it is to provide good UX for the users of your application. \nA big part of that is the ability to take different…","timeToRead":6,"html":"<p>As a web developer we knows how important it is to provide good UX for the users of your application.\nA big part of that is the ability to take different actions based on what the user is currently seeing.</p>\n<p>This could be an infinite scroll — when the user reaches the bottom of a list of items you load the next ones in advance.\nLazy loading images is another great example — no need to load something and risk a performance hit if the user never\ngets to see it anyway.</p>\n<p>While those are the most common practices used today there are many other use cases that depend on the business logic of\nyour application. For example, you may want a simple animation to occur when an element enter the browser's viewport to\ndemo the Intersection API.</p>\n<h1>The Intersection Observer</h1>\n<p>The Intersection Observer API allows us to watch a certain element and run a callback when its visibility changes in\nrelation to the view port or another element.</p>\n<p>We can specify an intersection ratio to tell the Intersection Observer what percentage of your element needs to be\nvisible in order to trigger the callback. This must be a value between 0 and 1.</p>\n<p>Another configuration option that needs to be specified when you initialise the Intersection Observer is the root. This\nis the element in relevance to which we will be watching for intersections. Most of the time this will be the full view\nport which means that we need to pass null as a value.</p>\n<p>We can initialise an Intersection Observer which will run a callback every time our target is intersecting\nin the view port as this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// Create and initialize an observer  </span>\n<span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">[</span>entry<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// is run when DOMElement match the thresholds</span>\n  <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  root<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// use the browsers viewport</span>\n  rootMargin<span class=\"token punctuation\">:</span> <span class=\"token string\">'0px'</span><span class=\"token punctuation\">,</span>\n  threshold<span class=\"token punctuation\">:</span> thresholds <span class=\"token comment\">// thresholds for the observer to detect</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Start observing the dom element</span>\nobserver<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>DOMElement<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>To specify the element that we actually want to watch we need to use the observe method and pass it a DOM element.</p>\n<p>When an element that meets the threshold requirements and enters the view port it will run the callback provided when\nthe Intersection Observer was initialised and it will pass the callback an array of entries. In the code above we are\nonly interested in the first element.</p>\n<p>Each element in the array passed to the callback has the following shape:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">callback</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">entries<span class=\"token punctuation\">,</span> observer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> \n  entries<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Each entry describes an intersection change for one observed</span>\n    <span class=\"token comment\">// target element:</span>\n    <span class=\"token comment\">//   entry.boundingClientRect</span>\n    <span class=\"token comment\">//   entry.intersectionRatio</span>\n    <span class=\"token comment\">//   entry.intersectionRect</span>\n    <span class=\"token comment\">//   entry.isIntersecting</span>\n    <span class=\"token comment\">//   entry.rootBounds</span>\n    <span class=\"token comment\">//   entry.target</span>\n    <span class=\"token comment\">//   entry.time</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>In our example below, we are going to use the intersectionRatio property to get the intersection percentage and use that\nto animate the opacity or width of an element that is entering the viewport. Since we implement the observer in the\nelement itself we need only the first member of the array.</p>\n<h1>Intersection in React</h1>\n<p>How do we use the Intersection Observer in an application built with React? Let us first creating our boxes that\nthis demo are going to use: </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> styled <span class=\"token keyword\">from</span> <span class=\"token string\">\"styled-components\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Generic box styles</span>\n<span class=\"token keyword\">const</span> Box <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  position: relative;\n  background-color: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> backgroundColor <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> backgroundColor <span class=\"token operator\">||</span> <span class=\"token string\">\"black\"</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n  align-items: center;\n  color: white;\n  display: flex;\n  font-size: 1.5rem;\n  justify-content: center;\n  margin: 1rem 0;\n  min-height: 40vh;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// FadeBox</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> FadeBox <span class=\"token operator\">=</span> <span class=\"token function\">styled</span><span class=\"token punctuation\">(</span>Box<span class=\"token punctuation\">)</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  opacity: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> ratio <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ratio <span class=\"token operator\">||</span> <span class=\"token number\">1</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n  width: 50%;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// WidthBox</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> WidthBox <span class=\"token operator\">=</span> <span class=\"token function\">styled</span><span class=\"token punctuation\">(</span>Box<span class=\"token punctuation\">)</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  width: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> ratio <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>ratio <span class=\"token operator\">*</span> <span class=\"token number\">100</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">%</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>We are using styled-components and define two simple boxes, FadeBox and WidthBox, both of them allows us to dynamically\nchange their styles with a ratio property to create some animation effect.</p>\n<p>Lets create an intersection box, that will render either the WidthBox or the FadeBox:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token comment\">// Import the two boxes</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FadeBox<span class=\"token punctuation\">,</span> WidthBox <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./Boxes'</span>\n\n<span class=\"token comment\">// Array containing both box types</span>\n<span class=\"token keyword\">const</span> compToRender <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>WidthBox<span class=\"token punctuation\">,</span> FadeBox<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\">/**\n * Box using intersection API to alter the styles\n * of the rendered boxes when the boxes enter the viewport\n * @param {number} boxType - number that match the index of the compToRender array\n * @param rest\n * @returns {*}\n * @constructor\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">IntersectBox</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> boxType<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>rest <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Which box type to render</span>\n  <span class=\"token keyword\">const</span> Component <span class=\"token operator\">=</span> compToRender<span class=\"token punctuation\">[</span>boxType<span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Component <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>rest<span class=\"token punctuation\">}</span> <span class=\"token operator\">></span>\n      <span class=\"token operator\">...</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Component<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> IntersectBox</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>In my last article, I wrote about Refs in React and now we need that feature in order to tell the Intersection Observer\nwe are going to create to start observe our DOM element.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// Use React's hook useRef to hold a </span>\n<span class=\"token comment\">// reference to a DOM element</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useRef <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span></span>\n<span class=\"token comment\">// Import the two boxes</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FadeBox<span class=\"token punctuation\">,</span> WidthBox <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./Boxes'</span>\n\n<span class=\"token comment\">// Array containing both box types</span>\n<span class=\"token keyword\">const</span> compToRender <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>WidthBox<span class=\"token punctuation\">,</span> FadeBox<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\">/**\n * Box using intersection API to alter the styles\n * of the rendered boxes when the boxes enter the viewport\n * @param boxType\n * @param rest\n * @returns {*}\n * @constructor\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">IntersectBox</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> boxType<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>rest <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Ref for DOM element to observe</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> targetRef <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></span>  \n  <span class=\"token comment\">// Which box type to render</span>\n  <span class=\"token keyword\">const</span> Component <span class=\"token operator\">=</span> compToRender<span class=\"token punctuation\">[</span>boxType<span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token operator\">&lt;</span>Component ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>targetRef<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>rest<span class=\"token punctuation\">}</span> <span class=\"token operator\">></span></span>      <span class=\"token operator\">...</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Component<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> IntersectBox</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Next, we need to add the Intersection Observer and to do that we can use React's useEffect hook. The useEffect hook\nlets us perform side effects in our function component. The useEffect hook is designed to run after every render of the\ncomponent and we can use it to create and initialize our Intersection Observer logic.</p>\n<p>It's also important to know that the useEffect hook has a dependency array we can pass into the hook itself and if the\ndependencies are the same as the last time it was executed, it will not run again. it seems perfect to pass a ref to\nthe target DOM Element as a dependency. </p>\n<blockquote>\n<p>It's important to know that React doing a shallow match when checking if the dependencies array has changed or not.</p>\n</blockquote>\n<p>In other words, we want to run the useEffect only after the first render to set up the Intersection Observer.</p>\n<p>We also need to store the intersection information in the local state to trigger re-renders and passing in the\nintersectionRatio value to our boxes and we use React's hook - useState for this. </p>\n<p>To provide the thresholds we create a function that by default builds an array from 0 - 1 and we can pass in how many\nsteps we want in between. </p>\n<p>Below is our Intersection component and I have tried to document what's going on inline.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token comment\">// useRef to get a reference to the DOM element being watched</span>\n<span class=\"token comment\">// useEffect to set up the intersection Observer logic</span>\n<span class=\"token comment\">// useState to trigger re-renders - animation of the boxes</span>\n<span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useRef<span class=\"token punctuation\">,</span> useEffect<span class=\"token punctuation\">,</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token comment\">// Import the two boxes</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FadeBox<span class=\"token punctuation\">,</span> WidthBox <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./Boxes'</span>\n\n<span class=\"token comment\">// Array containing both box types</span>\n<span class=\"token keyword\">const</span> compToRender <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>WidthBox<span class=\"token punctuation\">,</span> FadeBox<span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\">// Build threshold array to be used</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">buildThresholdList</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">numSteps <span class=\"token operator\">=</span> <span class=\"token number\">10</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> thresholds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> numSteps<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> ratio <span class=\"token operator\">=</span> i <span class=\"token operator\">/</span> numSteps\n    thresholds<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>ratio<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  thresholds<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> thresholds\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * Box using intersection API to alter the styles\n * of the rendered boxes when the boxes enter the viewport\n * @param boxType\n * @param rest\n * @returns {*}\n * @constructor\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">IntersectBox</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> boxType<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>rest <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Ref for DOM element to observe</span>\n  <span class=\"token keyword\">const</span> targetRef <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n  \n  <span class=\"token comment\">// state management for intersection information</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>entry<span class=\"token punctuation\">,</span> setEntry<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Run this effect only once, we are passing </span>\n  <span class=\"token comment\">// in targetRef in the dependencies array  </span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// Create a new observer</span>\n    <span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">[</span>entry<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// our callback - update local state with</span>\n      <span class=\"token comment\">// intersection entry information and triggers</span>\n      <span class=\"token comment\">// a re-render</span>\n      <span class=\"token function\">setEntry</span><span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      root<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n      rootMargin<span class=\"token punctuation\">:</span> <span class=\"token string\">'0px'</span><span class=\"token punctuation\">,</span>\n      threshold<span class=\"token punctuation\">:</span> <span class=\"token function\">buildThresholdList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Start observe the target</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>targetRef<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      observer<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>targetRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Clean up the observer on un-mounting</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> observer<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>targetRef<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Which box type to render</span>\n  <span class=\"token keyword\">const</span> Component <span class=\"token operator\">=</span> compToRender<span class=\"token punctuation\">[</span>boxType<span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Component ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>targetRef<span class=\"token punctuation\">}</span> ratio<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>entry<span class=\"token punctuation\">.</span>intersectionRatio<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>rest<span class=\"token punctuation\">}</span> <span class=\"token operator\">></span>\n      intersectionRatio<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span>intersectionRatio<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Component<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> IntersectBox</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>That's it, if you want to run a demo of this, you can create the following component to wrap everything up.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Import intersection box</span>\n<span class=\"token keyword\">import</span> IntersectBox <span class=\"token keyword\">from</span> <span class=\"token string\">'./IntersectBox'</span>\n\n<span class=\"token comment\">/**\n * Build an array with hex colors to apply as background colors in the boxes\n * @param quantity\n * @returns {string[]}\n */</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">buildHexArray</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">quantity</span> <span class=\"token operator\">=></span>\n  Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token function\">Array</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">i</span> <span class=\"token operator\">=></span>\n    <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">padStart</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Intersection API Demo\n * @returns {*}\n * @constructor\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">IntersectionDemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"App\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Intersection <span class=\"token constant\">API</span> Example<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>h2<span class=\"token operator\">></span>Start scrolling<span class=\"token operator\">!</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token function\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">i</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>br key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">{</span><span class=\"token function\">buildHexArray</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>IntersectBox boxType<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>i <span class=\"token operator\">%</span> <span class=\"token number\">2</span><span class=\"token punctuation\">}</span> key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>n<span class=\"token punctuation\">}</span> backgroundColor<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">#</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>n<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> IntersectionDemo</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/articles/react-intersection-api/"}}}