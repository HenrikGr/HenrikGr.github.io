<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.f0e6320b25128c443eb7.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#eee;background:#272822;font-family:Roboto Mono,monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#363636}:not(pre)>code[class*=language-]{white-space:normal;border-radius:.2em;padding:.1em}pre[class*=language-]{overflow:auto;position:relative;margin:.5em 0;padding:1.25em 1em}.language-css>code,.language-sass>code,.language-scss>code{color:#fd9170}[class*=language-] .namespace{opacity:.7}.token.atrule{color:#c792ea}.token.attr-name{color:#ffcb6b}.token.attr-value,.token.attribute{color:#a5e844}.token.boolean{color:#c792ea}.token.builtin{color:#ffcb6b}.token.cdata,.token.char{color:#80cbc4}.token.class{color:#ffcb6b}.token.class-name{color:#f2ff00}.token.comment{color:#616161}.token.constant{color:#c792ea}.token.deleted{color:#f66}.token.doctype{color:#616161}.token.entity{color:#f66}.token.function{color:#c792ea}.token.hexcode{color:#f2ff00}.token.id,.token.important{color:#c792ea;font-weight:700}.token.inserted{color:#80cbc4}.token.keyword{color:#c792ea}.token.number{color:#fd9170}.token.operator{color:#89ddff}.token.prolog{color:#616161}.token.property{color:#80cbc4}.token.pseudo-class,.token.pseudo-element{color:#a5e844}.token.punctuation{color:#89ddff}.token.regex{color:#f2ff00}.token.selector{color:#f66}.token.string{color:#a5e844}.token.symbol{color:#c792ea}.token.tag{color:#f66}.token.unit{color:#fd9170}.token.url,.token.variable{color:#f66}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}h1{font-size:30px;line-height:1.167;letter-spacing:0}h1,h2{font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;margin-top:16px;margin-bottom:8px}h2{font-size:24px;line-height:1.235;letter-spacing:.00735em}h3{font-family:Roboto,Helvetica,Arial,sans-serif;font-size:18px;font-weight:500;line-height:1.334;letter-spacing:0;margin-top:16px;margin-bottom:8px}caption{font-size:.75rem;line-height:1.67;letter-spacing:.03333rem;margin:0}caption,p{font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400}p{line-height:1.43;letter-spacing:.01071em;margin-top:0;margin-bottom:16px}li,p{font-size:.875rem}li{font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.5;letter-spacing:.01786rem;margin:8px 0 0}blockquote{margin:0 0 16px;padding:16px;border-left:5px solid #d84315;background-color:#272822;color:#fff}blockquote>p{margin:0}a{color:#ff9800}.gatsby-highlight{background-color:#272822;border-radius:.4em;margin:1.6em 0;padding:1em;overflow:auto}.gatsby-highlight pre[class*=language-].line-numbers{padding:0 0 0 2.8em;overflow:initial}.gatsby-highlight-code-line{background-color:#000;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid #111}</style><meta name="generator" content="Gatsby 3.3.1"/><title data-react-helmet="true">Henrik Grönvall Consulting AB - Web application security with CORS and CSP</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="Cross Origin Resource Sharing (CORS) and Content Security Policy (CSP) are HTTP response headers which when implemented
help to improve the security of a web…"/><meta data-react-helmet="true" name="keywords" content="JavaScript,React,Node.js,HTML,CSS,Cloud"/><style id="jss-server-side">.jss4{padding-top:16px;padding-bottom:16px}.jss5{padding-top:16px;padding-left:16px;padding-right:16px;padding-bottom:16px}.jss6{padding-top:8px;padding-bottom:8px}.MuiTypography-root{margin:0}.MuiTypography-body2{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.43;letter-spacing:.01071em}.MuiTypography-body1{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.5;letter-spacing:.00938em}.MuiTypography-caption{font-size:.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.66;letter-spacing:.03333em}.MuiTypography-button{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.75;letter-spacing:.02857em;text-transform:uppercase}.MuiTypography-h1{font-size:6rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1.167;letter-spacing:-.01562em}.MuiTypography-h2{font-size:3.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1.2;letter-spacing:-.00833em}.MuiTypography-h3{font-size:3rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.167;letter-spacing:0}.MuiTypography-h4{font-size:2.125rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.235;letter-spacing:.00735em}.MuiTypography-h5{font-size:1.5rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.334;letter-spacing:0}.MuiTypography-h6{font-size:1.25rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.6;letter-spacing:.0075em}.MuiTypography-subtitle1{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.75;letter-spacing:.00938em}.MuiTypography-subtitle2{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.57;letter-spacing:.00714em}.MuiTypography-overline{font-size:.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:2.66;letter-spacing:.08333em;text-transform:uppercase}.MuiTypography-srOnly{width:1px;height:1px;overflow:hidden;position:absolute}.MuiTypography-alignLeft{text-align:left}.MuiTypography-alignCenter{text-align:center}.MuiTypography-alignRight{text-align:right}.MuiTypography-alignJustify{text-align:justify}.MuiTypography-noWrap{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.MuiTypography-gutterBottom{margin-bottom:.35em}.MuiTypography-paragraph{margin-bottom:16px}.MuiTypography-colorInherit{color:inherit}.MuiTypography-colorPrimary{color:#3f51b5}.MuiTypography-colorSecondary{color:#f50057}.MuiTypography-colorTextPrimary{color:rgba(0,0,0,.87)}.MuiTypography-colorTextSecondary{color:rgba(0,0,0,.54)}.MuiTypography-colorError{color:#f44336}.MuiTypography-displayInline{display:inline}.MuiTypography-displayBlock{display:block}.MuiPaper-root{color:rgba(0,0,0,.87);transition:box-shadow .3s cubic-bezier(.4,0,.2,1) 0s;background-color:#fff}.MuiPaper-rounded{border-radius:4px}.MuiPaper-outlined{border:1px solid rgba(0,0,0,.12)}.MuiPaper-elevation0{box-shadow:none}.MuiPaper-elevation1{box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12)}.MuiPaper-elevation2{box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.MuiPaper-elevation3{box-shadow:0 3px 3px -2px rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 1px 8px 0 rgba(0,0,0,.12)}.MuiPaper-elevation4{box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)}.MuiPaper-elevation5{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 5px 8px 0 rgba(0,0,0,.14),0 1px 14px 0 rgba(0,0,0,.12)}.MuiPaper-elevation6{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12)}.MuiPaper-elevation7{box-shadow:0 4px 5px -2px rgba(0,0,0,.2),0 7px 10px 1px rgba(0,0,0,.14),0 2px 16px 1px rgba(0,0,0,.12)}.MuiPaper-elevation8{box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.MuiPaper-elevation9{box-shadow:0 5px 6px -3px rgba(0,0,0,.2),0 9px 12px 1px rgba(0,0,0,.14),0 3px 16px 2px rgba(0,0,0,.12)}.MuiPaper-elevation10{box-shadow:0 6px 6px -3px rgba(0,0,0,.2),0 10px 14px 1px rgba(0,0,0,.14),0 4px 18px 3px rgba(0,0,0,.12)}.MuiPaper-elevation11{box-shadow:0 6px 7px -4px rgba(0,0,0,.2),0 11px 15px 1px rgba(0,0,0,.14),0 4px 20px 3px rgba(0,0,0,.12)}.MuiPaper-elevation12{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 12px 17px 2px rgba(0,0,0,.14),0 5px 22px 4px rgba(0,0,0,.12)}.MuiPaper-elevation13{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 13px 19px 2px rgba(0,0,0,.14),0 5px 24px 4px rgba(0,0,0,.12)}.MuiPaper-elevation14{box-shadow:0 7px 9px -4px rgba(0,0,0,.2),0 14px 21px 2px rgba(0,0,0,.14),0 5px 26px 4px rgba(0,0,0,.12)}.MuiPaper-elevation15{box-shadow:0 8px 9px -5px rgba(0,0,0,.2),0 15px 22px 2px rgba(0,0,0,.14),0 6px 28px 5px rgba(0,0,0,.12)}.MuiPaper-elevation16{box-shadow:0 8px 10px -5px rgba(0,0,0,.2),0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12)}.MuiPaper-elevation17{box-shadow:0 8px 11px -5px rgba(0,0,0,.2),0 17px 26px 2px rgba(0,0,0,.14),0 6px 32px 5px rgba(0,0,0,.12)}.MuiPaper-elevation18{box-shadow:0 9px 11px -5px rgba(0,0,0,.2),0 18px 28px 2px rgba(0,0,0,.14),0 7px 34px 6px rgba(0,0,0,.12)}.MuiPaper-elevation19{box-shadow:0 9px 12px -6px rgba(0,0,0,.2),0 19px 29px 2px rgba(0,0,0,.14),0 7px 36px 6px rgba(0,0,0,.12)}.MuiPaper-elevation20{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 20px 31px 3px rgba(0,0,0,.14),0 8px 38px 7px rgba(0,0,0,.12)}.MuiPaper-elevation21{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 21px 33px 3px rgba(0,0,0,.14),0 8px 40px 7px rgba(0,0,0,.12)}.MuiPaper-elevation22{box-shadow:0 10px 14px -6px rgba(0,0,0,.2),0 22px 35px 3px rgba(0,0,0,.14),0 8px 42px 7px rgba(0,0,0,.12)}.MuiPaper-elevation23{box-shadow:0 11px 14px -7px rgba(0,0,0,.2),0 23px 36px 3px rgba(0,0,0,.14),0 9px 44px 8px rgba(0,0,0,.12)}.MuiPaper-elevation24{box-shadow:0 11px 15px -7px rgba(0,0,0,.2),0 24px 38px 3px rgba(0,0,0,.14),0 9px 46px 8px rgba(0,0,0,.12)}.MuiAppBar-root{width:100%;display:flex;z-index:1100;box-sizing:border-box;flex-shrink:0;flex-direction:column}.MuiAppBar-positionFixed{top:0;left:auto;right:0;position:fixed}@media print{.MuiAppBar-positionFixed{position:absolute}}.MuiAppBar-positionAbsolute{top:0;left:auto;right:0;position:absolute}.MuiAppBar-positionSticky{top:0;left:auto;right:0;position:sticky}.MuiAppBar-positionStatic{position:static}.MuiAppBar-positionRelative{position:relative}.MuiAppBar-colorDefault{color:rgba(0,0,0,.87);background-color:#f5f5f5}.MuiAppBar-colorPrimary{color:#fff;background-color:#3f51b5}.MuiAppBar-colorSecondary{color:#fff;background-color:#f50057}.MuiAppBar-colorInherit{color:inherit}.MuiAppBar-colorTransparent{color:inherit;background-color:transparent}.MuiToolbar-root{display:flex;position:relative;align-items:center}.MuiToolbar-gutters{padding-left:16px;padding-right:16px}@media (min-width:600px){.MuiToolbar-gutters{padding-left:24px;padding-right:24px}}.MuiToolbar-regular{min-height:56px}@media (min-width:0px) and (orientation:landscape){.MuiToolbar-regular{min-height:48px}}@media (min-width:600px){.MuiToolbar-regular{min-height:64px}}.MuiToolbar-dense{min-height:48px}.MuiButtonBase-root{color:inherit;border:0;cursor:pointer;margin:0;display:inline-flex;outline:0;padding:0;position:relative;align-items:center;user-select:none;border-radius:0;vertical-align:middle;-moz-appearance:none;justify-content:center;text-decoration:none;background-color:transparent;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.MuiButtonBase-root::-moz-focus-inner{border-style:none}.MuiButtonBase-root.Mui-disabled{cursor:default;pointer-events:none}@media print{.MuiButtonBase-root{color-adjust:exact}}.MuiIconButton-root{flex:0 0 auto;color:rgba(0,0,0,.54);padding:12px;overflow:visible;font-size:1.5rem;text-align:center;transition:background-color 150ms cubic-bezier(.4,0,.2,1) 0s;border-radius:50%}.MuiIconButton-root:hover{background-color:rgba(0,0,0,.04)}.MuiIconButton-root.Mui-disabled{color:rgba(0,0,0,.26);background-color:transparent}@media (hover:none){.MuiIconButton-root:hover{background-color:transparent}}.MuiIconButton-edgeStart{margin-left:-12px}.MuiIconButton-sizeSmall.MuiIconButton-edgeStart{margin-left:-3px}.MuiIconButton-edgeEnd{margin-right:-12px}.MuiIconButton-sizeSmall.MuiIconButton-edgeEnd{margin-right:-3px}.MuiIconButton-colorInherit{color:inherit}.MuiIconButton-colorPrimary{color:#3f51b5}.MuiIconButton-colorPrimary:hover{background-color:rgba(63,81,181,.04)}@media (hover:none){.MuiIconButton-colorPrimary:hover{background-color:transparent}}.MuiIconButton-colorSecondary{color:#f50057}.MuiIconButton-colorSecondary:hover{background-color:rgba(245,0,87,.04)}@media (hover:none){.MuiIconButton-colorSecondary:hover{background-color:transparent}}.MuiIconButton-sizeSmall{padding:3px;font-size:1.125rem}.MuiIconButton-label{width:100%;display:flex;align-items:inherit;justify-content:inherit}.MuiSvgIcon-root{fill:currentColor;width:1em;height:1em;display:inline-block;font-size:1.5rem;transition:fill .2s cubic-bezier(.4,0,.2,1) 0s;flex-shrink:0;user-select:none}.MuiSvgIcon-colorPrimary{color:#3f51b5}.MuiSvgIcon-colorSecondary{color:#f50057}.MuiSvgIcon-colorAction{color:rgba(0,0,0,.54)}.MuiSvgIcon-colorError{color:#f44336}.MuiSvgIcon-colorDisabled{color:rgba(0,0,0,.26)}.MuiSvgIcon-fontSizeInherit{font-size:inherit}.MuiSvgIcon-fontSizeSmall{font-size:1.25rem}.MuiSvgIcon-fontSizeLarge{font-size:2.1875rem}.MuiLink-underlineNone{text-decoration:none}.MuiLink-underlineHover{text-decoration:none}.MuiLink-underlineHover:hover{text-decoration:underline}.MuiLink-underlineAlways{text-decoration:underline}.MuiLink-button{border:0;cursor:pointer;margin:0;outline:0;padding:0;position:relative;user-select:none;border-radius:0;vertical-align:middle;-moz-appearance:none;background-color:transparent;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.MuiLink-button::-moz-focus-inner{border-style:none}.MuiLink-button.Mui-focusVisible{outline:auto}.MuiFab-root{color:rgba(0,0,0,.87);width:56px;height:56px;padding:0;font-size:.875rem;min-width:0;box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12);box-sizing:border-box;min-height:36px;transition:background-color 250ms cubic-bezier(.4,0,.2,1) 0s,box-shadow 250ms cubic-bezier(.4,0,.2,1) 0s,border 250ms cubic-bezier(.4,0,.2,1) 0s;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.75;border-radius:50%;letter-spacing:.02857em;text-transform:uppercase;background-color:#e0e0e0}.MuiFab-root:active{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 12px 17px 2px rgba(0,0,0,.14),0 5px 22px 4px rgba(0,0,0,.12)}.MuiFab-root:hover{text-decoration:none;background-color:#d5d5d5}.MuiFab-root.Mui-focusVisible{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12)}.MuiFab-root.Mui-disabled{color:rgba(0,0,0,.26);box-shadow:none;background-color:rgba(0,0,0,.12)}@media (hover:none){.MuiFab-root:hover{background-color:#e0e0e0}}.MuiFab-root:hover.Mui-disabled{background-color:rgba(0,0,0,.12)}.MuiFab-label{width:100%;display:inherit;align-items:inherit;justify-content:inherit}.MuiFab-primary{color:#fff;background-color:#3f51b5}.MuiFab-primary:hover{background-color:#303f9f}@media (hover:none){.MuiFab-primary:hover{background-color:#3f51b5}}.MuiFab-secondary{color:#fff;background-color:#f50057}.MuiFab-secondary:hover{background-color:#c51162}@media (hover:none){.MuiFab-secondary:hover{background-color:#f50057}}.MuiFab-extended{width:auto;height:48px;padding:0 16px;min-width:48px;min-height:auto;border-radius:24px}.MuiFab-extended.MuiFab-sizeSmall{width:auto;height:34px;padding:0 8px;min-width:34px;border-radius:17px}.MuiFab-extended.MuiFab-sizeMedium{width:auto;height:40px;padding:0 16px;min-width:40px;border-radius:20px}.MuiFab-colorInherit{color:inherit}.MuiFab-sizeSmall{width:40px;height:40px}.MuiFab-sizeMedium{width:48px;height:48px}.MuiContainer-root{width:100%;display:block;box-sizing:border-box;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px}@media (min-width:600px){.MuiContainer-root{padding-left:24px;padding-right:24px}}.MuiContainer-disableGutters{padding-left:0;padding-right:0}@media (min-width:600px){.MuiContainer-fixed{max-width:600px}}@media (min-width:960px){.MuiContainer-fixed{max-width:960px}}@media (min-width:1280px){.MuiContainer-fixed{max-width:1280px}}@media (min-width:1920px){.MuiContainer-fixed{max-width:1920px}}@media (min-width:0px){.MuiContainer-maxWidthXs{max-width:444px}}@media (min-width:600px){.MuiContainer-maxWidthSm{max-width:600px}}@media (min-width:960px){.MuiContainer-maxWidthMd{max-width:960px}}@media (min-width:1280px){.MuiContainer-maxWidthLg{max-width:1280px}}@media (min-width:1920px){.MuiContainer-maxWidthXl{max-width:1920px}}.MuiCard-root{overflow:hidden}.jss12{right:16px;bottom:16px;position:fixed}.jss10{color:#fff;background-color:#3f51b5}.jss11{color:#fff;background-color:#3f51b5}.jss7{color:#fff;padding:48px 16px;margin-top:64px;background-color:#3f51b5}.MuiDivider-root{border:none;height:1px;margin:0;flex-shrink:0;background-color:rgba(0,0,0,.12)}.MuiDivider-absolute{left:0;width:100%;bottom:0;position:absolute}.MuiDivider-inset{margin-left:72px}.MuiDivider-light{background-color:rgba(0,0,0,.08)}.MuiDivider-middle{margin-left:16px;margin-right:16px}.MuiDivider-vertical{width:1px;height:100%}.MuiDivider-flexItem{height:auto;align-self:stretch}.MuiCardMedia-root{display:block;background-size:cover;background-repeat:no-repeat;background-position:center}.MuiCardMedia-media{width:100%}.MuiCardMedia-img{object-fit:cover}.jss1{height:210px}.jss2{font-size:14px;padding-top:16px}.jss3{font-size:14px}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-3f45427426fd7161da8e.js"/><link as="script" rel="preload" href="/framework-a6306eaaf8346efc791c.js"/><link as="script" rel="preload" href="/app-ab328917ee7b8a5b5eb3.js"/><link as="script" rel="preload" href="/commons-7366a34b018bd46c988c.js"/><link as="script" rel="preload" href="/875d5575f84d2db311b8feddedb7ed30b8fce884-8e0df0fbb1f2b518c4b4.js"/><link as="script" rel="preload" href="/component---src-templates-article-page-template-js-4aee4b756c530e8f4ae6.js"/><link as="fetch" rel="preload" href="/page-data/articles/node-http-secorutiy/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4011214723.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="MuiPaper-root MuiAppBar-root MuiAppBar-positionFixed MuiAppBar-colorPrimary mui-fixed MuiPaper-elevation0"><div class="MuiToolbar-root MuiToolbar-regular MuiToolbar-gutters"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-edgeStart" tabindex="0" type="button" aria-label="menu"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></span></button><h6 class="MuiTypography-root MuiTypography-subtitle1 MuiTypography-colorInherit">Web application security with CORS and CSP</h6></div></header><div class="MuiToolbar-root MuiToolbar-regular MuiToolbar-gutters" id="back-to-top-anchor"></div><div class="MuiContainer-root MuiBox-root jss4 MuiContainer-maxWidthMd"><div class="MuiPaper-root MuiCard-root MuiPaper-elevation1 MuiPaper-rounded"><div class="MuiCardMedia-root jss1" style="background-image:url(&quot;https://source.unsplash.com/random?spring&quot;)"></div><div class="MuiBox-root jss5"><div><p>Cross Origin Resource Sharing (CORS) and Content Security Policy (CSP) are HTTP response headers which when implemented
help to improve the security of a web application. Both security headers allow application owners to whitelist the
origin of resources in their web application. Both seems to work the same but there are differences.</p>
<p>To understand Cross Origin Resource Sharing (CORS) and Content Security Policy (CSP) headers we need to understand
<em>SameOriginPolicy</em> first.</p>
<h2>Same-origin policy</h2>
<p>The same-origin policy is a browser security feature that restricts how documents and scripts on one origin can interact
with resources on another origin.</p>
<p>An origin is defined by the scheme (also known as the protocol, for example HTTP or HTTPS), port (if it is specified),
and host. When all three are the same for two URLs, they are considered same-origin.</p>
<p>For example, <a href="http://example.com:5000/foo">http://example.com:5000/foo</a> is the same origin as <a href="http://example.com:5000/bar">http://example.com:5000/bar</a> but not
<a href="https://example.com:5000/status">https://example.com:5000/status</a> because the scheme is different.</p>
<h3>What is permitted and blocked by the same-origin policy</h3>
<p>A browser can load and display resources from multiple sites at once. You might have multiple tabs open at the same time,
or a site could embed multiple iframes from different sites. If there is no restriction on interactions between these
resources, and a script is compromised by an attacker, the script could expose everything in a user's browser.</p>
<p>The same-origin policy controls interactions between two different origins. These interactions are typically placed
into three categories:</p>
<ol>
<li>Cross-origin writes are typically allowed.
Examples are links, redirects, and form submissions.
Some HTTP requests require preflight.</li>
<li>Cross-origin embedding is typically allowed.</li>
<li>Cross-origin reads are typically disallowed, but read access is often leaked by embedding.
For example, you can read the dimensions of an embedded image, the actions of an embedded script, or the availability
of an embedded resource.</li>
</ol>
<p>The same-origin policy has some historical exceptions as you can see and if the web could be designed from scratch, these
exceptions wouldn't exist. Unfortunately, by the time the web community realized the key benefits of a strict same-origin
policy, the web was already relying on these exceptions.</p>
<h2>Cross Origin Resource Sharing (CORS)</h2>
<p>Cross-Origin Resource Sharing (CORS) is a protocol that enables scripts running on a browser client to interact with
resources from a different origin. This is useful because, thanks to the same-origin policy followed by XMLHttpRequest
and Fetch API, JavaScript can only make calls to URLs that live on the same origin as the location where the script
is running.</p>
<p>Most of the time, a script running in the user's browser would only ever need to access resources on the same origin
(think about API calls to the same backend that served the JavaScript code in the first place). So the fact that
JavaScript can't normally access resources on other origins is a good thing for security.</p>
<p>However, there are legitimate scenarios where cross-origin access is desirable or even necessary. For example, if you're
running a React SPA that makes requests to an API backend running on a different origins.</p>
<p>On the server side, when a server has been configured correctly to allow cross-origin resource sharing, some special
headers will be included. Their presence can be used to determine that a request supports CORS. Web browsers can use
these headers to determine whether a request call should continue or fail.</p>
<p>There are a few headers that can be set, but the primary one that determines who can access a resource is
Access-Control-Allow-Origin. This header specifies which origins can access the resource. For example, to allow access
from any origin, you can set the response header as follows:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Access-Control-Allow-Origin: *</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Or it can be narrowed down to a specific origin:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Access-Control-Allow-Origin: https://example.com</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>CORS is normally used for "anonymous requests" where the request does not identify the requester. If you want to send
cookies (which could identify the sender) using for example the Fetch API, you need to add additional headers to the
request and response.</p>
<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://example.com'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'cors'</span><span class="token punctuation">,</span>
  credentials<span class="token operator">:</span> <span class="token string">'include'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>The response headers from the server should now look like:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Credentials: true</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Note: The Access-Control-Allow-Origin should have an origin set in the response header, and the
Access-Control-Allow-Credentials should be set to true.</p>
<h3>Understanding CORS request types</h3>
<p>There are two types of CORS request: "simple" requests and "preflight" requests. It's the browser that determines
which is used. As the developer, you don't normally need to care about this when you are constructing requests to be
sent to a server. However, you may see the different types of requests appear in your network log, and since it may have
a performance impact on your application it may benefit you to know why and when these requests are sent.</p>
<p>The browser deems the request to be a "simple" request when the request itself meets a certain set of requirements:</p>
<ul>
<li>One of these methods is used: GET, POST, or HEAD.</li>
<li>A CORS safe-listed header is used.</li>
<li>When using the Content-Type header, only the following values are allowed: application/x-www-form-urlencoded, multipart/form-data, or text/plain.</li>
<li>No event listeners are registered on any XMLHttpRequestUpload object.</li>
<li>No ReadableStream object is used in the request.</li>
</ul>
<p>The request is allowed to continue as normal if it meets these criteria, and the Access-Control-Allow-Origin header is
checked when the response is returned.</p>
<p>If a request does not meet the criteria for a "simple" request, the browser will instead make an automatic preflight
request using the OPTIONS method. This call is used to determine the exact CORS capabilities of the server, which is
in turn used to determine whether the intended CORS protocol is understood. If the result of the OPTIONS call
dictates that the request cannot be made, the actual request to the server will not be executed.</p>
<p>The preflight request sets the mode as OPTIONS and sets a couple of headers to describe the actual request that
is to follow:</p>
<ul>
<li>Access-Control-Request-Method: The intended method of the request (e.g., GET or POST).</li>
<li>Access-Control-Request-Headers: An indication of the custom headers that will be sent with the request.</li>
<li>Origin: The usual origin header that contains the script's current origin.</li>
</ul>
<p>An example of such a request might look like this:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">OPTIONS /data HTTP/1.1
Origin: https://example.com
Access-Control-Request-Method: DELETE
Access-Control-Request-Headers: Content-Type, Accept</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>This request basically says, I would like to make a DELETE request with the Content-Type and Accept headers on
<a href="https://example.com">https://example.com</a> - is that possible?</p>
<p>The server will include some Access-Control-* headers within the response to indicate whether the request that follows
will be allowed or not. These include:</p>
<ul>
<li>Access-Control-Allow-Origin: The origin that is allowed to make the request, or * if a request can be made from any origin.</li>
<li>Access-Control-Allow-Methods: A comma-separated list of HTTP methods that are allowed.</li>
<li>Access-Control-Allow-Headers: A comma-separated list of the custom headers that are allowed to be sent.</li>
<li>Access-Control-Max-Age: The maximum duration that the response to the preflight request can be cached before another call is made.</li>
</ul>
<p>A response to the earlier example might look like this:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET,HEAD,PUT,PATCH,POST,DELETE
Access-Control-Allow-Headers: Content-Type, Accept
Access-Control-Max-Age: 120
Vary: Access-Control-Request-Headers
Content-Length: 0
Connection: keep-alive</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The response would then be examined by the browser to decide whether to continue with the request or to abandon it.</p>
<p>The Access-Control-Allow-Origin header, in this case, allows the request to be made from any origin, while the
Access-Control-Allow-Methods header describes only the accepted HTTP methods. If a given HTTP method is not accepted,
it will not appear in this list.</p>
<p>In this example, Access-Control-Allow-Headers echos back the headers that were asked for in the OPTIONS request.
This indicates that all the requested headers are allowed to be sent. If for example, the server doesn't allow the
Accept header, then that header would be omitted from the response, and the browser would reject the call.</p>
<h2>Content Security Policy (CSP)</h2>
<p>Content Security Policy (CSP) header is used to define what content can run on its own domain. It is an added layer of
security that helps to detect and mitigate certain types of attacks, including Cross Site Scripting (XSS) and data
injection attacks. These attacks are used for everything from data theft to site defacement to distribution of malware.</p>
<p>To enable CSP, you need to configure your web server to return the Content-Security-Policy HTTP header.</p>
<p>Alternatively, the <meta> element can be used to configure a policy, for example:
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src https://*; child-src 'none';"></p>
<p>By injecting the Content-Security-Policy (CSP) headers from the server, the browser is aware and capable of protecting
the user from dynamic calls that will load content into the page currently being visited.</p>
<h3>Mitigating cross site scripting</h3>
<p>A primary goal of CSP is to mitigate and report XSS attacks. XSS attacks exploit the browser's trust of the content
received from the server. Malicious scripts are executed by the victim's browser because the browser trusts the source
of the content, even when it's not coming from where it seems to be coming from.</p>
<p>CSP makes it possible for server administrators to reduce or eliminate the vectors by which XSS can occur by specifying
the domains that the browser should consider to be valid sources of executable scripts. A CSP compatible browser will
then only execute scripts loaded in source files received from those allowlisted domains, ignoring all other script
(including inline scripts and event-handling HTML attributes).</p>
<p>As an ultimate form of protection, sites that want to never allow scripts to be executed can opt to globally disallow
script execution.</p>
<h3>Mitigating packet sniffing attacks</h3>
<p>In addition to restricting the domains from which content can be loaded, the server can specify which protocols are
allowed to be used; for example (and ideally, from a security standpoint), a server can specify that all content must
be loaded using HTTPS. A complete data transmission security strategy includes not only enforcing HTTPS for data
transfer, but also marking all cookies with the secure attribute and providing automatic redirects from HTTP pages to
their HTTPS counterparts. Sites may also use the Strict-Transport-Security HTTP header to ensure that browsers connect
to them only over an encrypted channel.</p>
<h3>Configure your CSP policy</h3>
<p>Configuring Content Security Policy involves adding the Content-Security-Policy HTTP header to a web page and giving it
values to control what resources the user agent is allowed to load for that page. For example, a page that uploads and
displays images could allow images from anywhere, but restrict a form action to a specific endpoint. A properly designed
Content Security Policy helps protect a page against a cross site scripting attack.</p>
<p>You can use the Content-Security-Policy HTTP header to specify your policy, like this:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Content-Security-Policy: policy</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>A policy is described using a series of policy directives, each of which describes the policy for a certain resource
type or policy area. Your policy should include a default-src policy directive, which is a fallback for other resource
types when they don't have policies of their own (for a complete list, see the description of the default-src directive).</p>
<p>A policy needs to include a default-src or script-src directive to prevent inline scripts from running, as well as
blocking the use of eval().</p>
<p>A policy needs to include a default-src or style-src directive to restrict inline styles from being applied from a
<code class="language-text">&lt;style&gt;</code> element, or a style attribute.</p>
<p>There are specific directives for a wide variety of types of items, so that each type can have its own policy, including
fonts, frames, images, audio and video media, scripts, and workers.</p>
<h2>Recommended measures for CSP</h2>
<p><a href="https://owasp.org/www-community/xss-filter-evasion-cheatsheet">The XSS Cheat Sheet</a> is an old but representative
cross-section of the methods an attacker might use to violate this trust by injecting malicious code. If an attacker
successfully injects any code at all, it's pretty much game over: user session data is compromised and information
that should be kept secret is exfiltrated.</p>
<p>The following overview highlights a defense that can significantly reduce the risk and impact of XSS attacks in modern
browsers.</p>
<h3>Source allow list</h3>
<p>The issue exploited by XSS attacks is the browser's inability to distinguish between script that's part of your
application and script that's been maliciously injected by a third party.</p>
<p>For example, if you trust some API to deliver valid code, you should define a policy that only allows script to execute
when it comes from the trusted sources:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Content-Security-Policy: script-src &#39;self&#39; https://apis.example.com</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>We used script-src which is a directive that controls a set of script-related privileges for a specific page. We've
specified 'self' as one valid source of script and <a href="https://apis.example.com">https://apis.example.com</a> as another. The browser dutifully downloads
and executes JavaScript from apis.example.com over HTTPS as well as from the current page's origin.</p>
<p>While script resources are the most obvious security risks, CSP provides a rich set of policy directives that enable
fairly granular control over the resources that a page is allowed to load.</p>
<h3>Policies that applies to a wide variety of resources</h3>
<p>Let's walk through the rest of the resource directives. The list below represents the state of the directives
as of level 2 specification. A level 3 spec has been published, but is largely unimplemented in the major browsers.</p>
<ul>
<li>base-uri, restricts the URLs that can appear in a page's <code class="language-text">&lt;base&gt;</code> element.</li>
<li>child-src, lists the URLs for workers and embedded frame contents.
For example: child-src <a href="https://youtube.com">https://youtube.com</a> would enable embedding videos from YouTube but not from other origins.</li>
<li>connect-src, limits the origins that you can connect to (via XHR, WebSockets, and EventSource).</li>
<li>font-src, specifies the origins that can serve web fonts.</li>
<li>form-action, lists valid endpoints for submission from <code class="language-text">&lt;form&gt;</code> tags.</li>
<li>frame-ancestors, specifies the sources that can embed the current page.
This directive applies to <code class="language-text">&lt;frame&gt;</code>, <code class="language-text">&lt;iframe&gt;</code>, <code class="language-text">&lt;embed&gt;</code>, and <code class="language-text">&lt;applet&gt;</code> tags.
This directive can't be used in <code class="language-text">&lt;meta&gt;</code> tags and applies only to non-HTML resources.</li>
<li>frame-src, was deprecated in level 2, but is restored in level 3.
If not present it still falls back to child-src as before.</li>
<li>img-src, defines the origins from which images can be loaded.</li>
<li>media-src, restricts the origins allowed to deliver video and audio.</li>
<li>object-src, allows control over Flash and other plugins.</li>
<li>plugin-types, limits the kinds of plugins a page may invoke.</li>
<li>report-uri, specifies a URL where a browser will send reports when a content security policy is violated.
This directive can't be used in <code class="language-text">&lt;meta&gt;</code> tags.</li>
<li>style-src, is script-src's counterpart for stylesheets.</li>
<li>upgrade-insecure-requests, instructs user agents to rewrite URL schemes, changing HTTP to HTTPS.
This directive is for websites with large numbers of old URL's that need to be rewritten.</li>
<li>worker-src, is a CSP Level 3 directive that restricts the URLs that may be loaded as a worker, shared worker, or service worker.</li>
</ul>
<p>By default, directives are wide open. If you don't set a specific policy for a directive, let's say font-src, then that
directive behaves by default as though you'd specified * as the valid source (for example, you could load fonts from
anywhere, without restriction).</p>
<p>You can override this default behavior by specifying a default-src directive. This directive defines the defaults for
most directives that you leave unspecified. Generally, this applies to any directive that ends with -src.
If default-src is set to <a href="https://example.com">https://example.com</a>, and you fail to specify a font-src directive, then you can load fonts
from <a href="https://example.com">https://example.com</a>, and nowhere else. We specified only script-src in our earlier examples, which means that
images, fonts, and so on can be loaded from any origin.</p>
<p>The following directives don't use default-src as a fallback. Remember that failing to set them is the same as allowing
anything.</p>
<ul>
<li>base-uri</li>
<li>form-action</li>
<li>frame-ancestors</li>
<li>plugin-types</li>
<li>report-uri</li>
<li>sandbox</li>
</ul>
<p>You can use as many or as few of these directives as makes sense for your specific application, simply listing each in
the HTTP header, separating directives with semicolons. Make sure that you list all required resources of a specific
type in a single directive. If you wrote something like script-src <a href="https://host1.com">https://host1.com</a>; script-src <a href="https://host2.com">https://host2.com</a> the
second directive would simply be ignored. Something like the following would correctly specify both origins as valid:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">script-src https://host1.com https://host2.com</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>If, for example, you have an application that loads all of its resources from a content delivery network (say,
<a href="https://cdn.example.net">https://cdn.example.net</a>), and know that you don't need any framed content or plugins, then your policy might look
something like the following:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Content-Security-Policy: default-src https://cdn.example.net; child-src &#39;none&#39;; object-src &#39;none&#39;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3>Implementation details of CSP</h3>
<p>You will see X-WebKit-CSP and X-Content-Security-Policy headers in various tutorials on the web. You should ignore these
prefixed headers. Modern browsers, except IE, support the un-prefixed Content-Security-Policy header.</p>
<p>Regardless of the header you use, policy is defined on a page-by-page basis: you'll need to send the HTTP header along
with every response that you'd like to ensure is protected. This provides a lot of flexibility, as you can fine-tune
the policy for specific pages based on their specific needs. Perhaps one set of pages in your site has a +1 button,
while others don't: you could allow the button code to be loaded only when necessary.</p>
<p>The source list in each directive is flexible. You can specify sources by scheme (data:, https:), or ranging in
specificity from hostname-only (example.com), which matches any origin on that host: any scheme, any port to a fully
qualified URI (<a href="https://example.com:443">https://example.com:443</a>), which matches only HTTPS, only example.com, and only port 443). Wildcards are
accepted, but only as a scheme, a port, or in the leftmost position of the hostname: <em>://</em>.example.com:* would match
all subdomains of example.com (but not example.com itself), using any scheme, on any port.</p>
<p>The source list also accepts four keywords:</p>
<ul>
<li>'none', as you might expect, matches nothing.</li>
<li>'self' matches the current origin, but not its subdomains.</li>
<li>'unsafe-inline' allows inline JavaScript and CSS.</li>
<li>'unsafe-eval' allows text-to-JavaScript mechanisms like eval.</li>
</ul>
<p>These keywords require single-quotes. For example, script-src 'self' (with quotes) authorizes the execution of JavaScript
from the current host; script-src self (no quotes) allows JavaScript from a server named "self" (and not from the
current host), which probably isn't what you meant.</p>
<h3>Sandboxing</h3>
<p>There's one more directive worth talking about: sandbox. It's a bit different from the others we've looked at, as it
places restrictions on actions that the page can take rather than on resources that the page can load. If the sandbox
directive is present, the page is treated as though it was loaded inside of an <code class="language-text">&lt;iframe&gt;</code> with a sandbox attribute.
This can have a wide range of effects on the page: forcing the page into a unique origin, and preventing form submission,
among others. It's a bit beyond the scope of this article, but you can find full details on valid sandboxing attributes
in the "Sandboxing" section of the <a href="https://html.spec.whatwg.org/dev/origin.html#sandboxing">HTML5 specification</a></p>
<h3>The meta tag</h3>
<p>CSPs preferred delivery mechanism is an HTTP header. It can be useful, however, to set a policy on a page directly in
the markup. Do that using a <code class="language-text">&lt;meta&gt;</code> tag with a http-equiv attribute:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src https://cdn.example.net; child-src &#39;none&#39;; object-src &#39;none&#39;&quot;&gt;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>This can't be used for frame-ancestors, report-uri, or sandbox.</p>
<h3>Inline code is considered harmful</h3>
<p>It should be clear that CSP is based on allowlist origins, as that's an unambiguous way of instructing the browser to
treat specific sets of resources as acceptable and to reject the rest. Origin-based allowlists don't, however, solve
the biggest threat posed by XSS attacks: inline script injection. If an attacker can inject a script tag that directly
contains some malicious payload <code class="language-text">&lt;script&gt;sendMyDataToEvilDotCom()&lt;/script&gt;</code>, the browser has no mechanism by which to
distinguish it from a legitimate inline script tag. CSP solves this problem by banning inline script entirely: it's the
only way to be sure.</p>
<p>This ban includes not only scripts embedded directly in script tags, but also inline event handlers and javascript:
URLs. You'll need to move the content of script tags into an external file, and replace javascript: URLs and
<code class="language-text">&lt;a ... onclick=&quot;[JAVASCRIPT]&quot;&gt;</code> with appropriate <code class="language-text">addEventListener()</code> calls. For example, you might rewrite the
following from:</p>
<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>
  <span class="token keyword">function</span> <span class="token function">doAmazingThings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'YOU AM AMAZING!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token string">'doAmazingThings();'</span><span class="token operator">></span>Am <span class="token constant">I</span> amazing<span class="token operator">?</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>to something more like:</p>
<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> amazing<span class="token punctuation">.</span>html <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'amazing.js'</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">'amazing'</span><span class="token operator">></span>Am <span class="token constant">I</span> amazing<span class="token operator">?</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// amazing.js</span>
<span class="token keyword">function</span> <span class="token function">doAmazingThings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'YOU AM AMAZING!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'amazing'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> doAmazingThings<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The rewritten code has a number of advantages above and beyond working well with CSP; it's already best practice,
regardless of your use of CSP. Inline JavaScript mixes structure and behavior in exactly the way you shouldn't.
External resources are easier for browsers to cache, more understandable for developers, and conducive to compilation
and minification. You'll write better code if you do the work to move code into external resources.</p>
<p>Inline style is treated in the same way: both the style attribute and style tags should be consolidated into external
stylesheets to protect against a variety of surprisingly clever data exfiltration methods that CSS enables.</p>
<p>If you must have inline script and style, you can enable it by adding 'unsafe-inline' as an allowed source in a
script-src or style-src directive. You can also use a nonce or a hash (see below), but you really shouldn't. Banning
inline script is the biggest security win CSP provides, and banning inline style likewise hardens your application.
It's a little bit of effort up front to ensure that things work correctly after moving all the code out-of-line, but
that's a tradeoff that's well worth making.</p>
<p><em><strong>If you absolutely must use it</strong></em>, CSP Level 2 offers backward compatibility for inline scripts by allowing you to add
specific inline scripts to the allowlist using either a cryptographic nonce (number used once) or a hash. Although this
may be cumbersome, it is useful in a pinch.</p>
<p>To use a nonce, give your script tag a nonce attribute. Its value must match one in the list of trusted sources. For
example:</p>
<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token operator">&lt;</span>script nonce<span class="token operator">=</span><span class="token string">"EDNnf03nceIOfn39fn3e9h3sdfa"</span><span class="token operator">></span>
  <span class="token comment">// Some inline code I can't remove yet, but need to asap.</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Now, add the nonce to your script-src directive appended to the nonce- keyword.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Content-Security-Policy: script-src &#39;nonce-EDNnf03nceIOfn39fn3e9h3sdfa&#39;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Remember that nonces must be regenerated for every page request and they must be unguessable.</p>
<p>Hashes work in much the same way. Instead of adding code to the script tag, create a SHA hash of the script itself and
add it to the script-src directive. For example, let's say your page contained this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello, world.'</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Your policy would contain this:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Content-Security-Policy: script-src &#39;sha256-qznLcsROx4GACP2dm0UCKCzCG-HiZ1guq6ZZDob_Tng=&#39;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>There are a few things to note here. The sha*- prefix specifies the algorithm that generates the hash. In the example
above, sha256- is used. CSP also supports sha384- and sha512-. When generating the hash, do not include the <code class="language-text">&lt;script&gt;</code>
tags. Also capitalization and whitespace matter, including leading or trailing whitespace.</p>
<p>A Google search on generating SHA hashes will lead you to solutions in any number of languages. Using Chrome 40 or
later, you can open DevTools and then reload your page. The Console tab will contain error messages with the correct
sha256 hash for each of your inline scripts.</p>
<h3>Eval too</h3>
<p>Even when an attacker can't inject script directly, they might be able to trick your application into converting
otherwise inert text into executable JavaScript and executing it on their behalf. <code class="language-text">eval()</code>, <code class="language-text">new Function()</code>,
<code class="language-text">setTimeout([string], ...)</code>, and <code class="language-text">setInterval([string], ...)</code> are all vectors through which injected text might end up
executing something unexpectedly malicious. CSP's default response to this risk is to completely block all of these vectors.</p>
<p>This has more than a few impacts on the way you build applications:</p>
<ul>
<li>You must parse JSON via the built-in JSON.parse, rather than relying on eval. Native JSON operations are available in every browser since IE8, and they're completely safe.</li>
<li>Rewrite any setTimeout or setInterval calls you're currently making with inline functions rather than strings. For example:</li>
</ul>
<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">"document.querySelector('a').style.display = 'none';"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>would be better written as:</p>
<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<ul>
<li>Avoid inline templating at runtime: Many templating libraries use <code class="language-text">new Function()</code> liberally to speed up template
generation at runtime. It's a nifty application of dynamic programming, but comes at the risk of evaluating malicious text.
Some frameworks support CSP out of the box, falling back to a robust parser in the absence of eval.</li>
</ul>
<p>However, a better choice would be a templating language that offers precompilation (Handlebars does, for instance).
Precompiling your templates can make the user experience even faster than the fastest runtime implementation, and it's
safer too. If eval and its text-to-JavaScript brethren are essential to your application, you can enable them by adding
'unsafe-eval' as an allowed source in a script-src directive, but we strongly discourage this. Banning the ability to
execute strings makes it much more difficult for an attacker to execute unauthorized code on your site.</p>
<h3>Reporting</h3>
<p>CSP's ability to block untrusted resources client-side is a huge win for your users, but it would be quite helpful to
have some sort of notification sent back to the server so that you can identify and squash any bugs that allow malicious
injection in the first place. To this end, you can instruct the browser to POST JSON-formatted violation reports to a
location specified in a report-uri directive.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Content-Security-Policy: default-src &#39;self&#39;; ...; report-uri /my_amazing_csp_report_parser;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Those reports will look something like the following:</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
   <span class="token property">"csp-report"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">"document-uri"</span><span class="token operator">:</span> <span class="token string">"http://example.org/page.html"</span><span class="token punctuation">,</span>
   <span class="token property">"referrer"</span><span class="token operator">:</span> <span class="token string">"http://evil.example.com/"</span><span class="token punctuation">,</span>
   <span class="token property">"blocked-uri"</span><span class="token operator">:</span> <span class="token string">"http://evil.example.com/evil.js"</span><span class="token punctuation">,</span>
   <span class="token property">"violated-directive"</span><span class="token operator">:</span> <span class="token string">"script-src 'self' https://apis.google.com"</span><span class="token punctuation">,</span>
   <span class="token property">"original-policy"</span><span class="token operator">:</span> <span class="token string">"script-src 'self' https://apis.google.com; report-uri http://example.org/my_amazing_csp_report_parser"</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>This contains a good chunk of information that will help you track down the specific cause of the violation, including
the page on which the violation occurred (document-uri), that page's referrer (note that unlike the HTTP header field,
the key is not misspelled), the resource that violated the page's policy (blocked-uri), the specific directive it
violated (violated-directive), and the page's complete policy (original-policy).</p>
<h3>Report only</h3>
<p>If you're just starting out with CSP, it makes sense to evaluate the current state of your application before rolling
out a draconian policy to your users. As a stepping stone to a complete deployment, you can ask the browser to monitor
a policy, reporting violations but not enforcing the restrictions. Instead of sending a Content-Security-Policy header,
send a Content-Security-Policy-Report-Only header.</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Content-Security-Policy-Report-Only: default-src &#39;self&#39;; ...; report-uri /my_amazing_csp_report_parser;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>The policy specified in report-only mode won't block restricted resources, but it will send violation reports to the
location you specify. You can even send both headers, enforcing one policy while monitoring another. This is a great
way to evaluate the effect of changes to your application's CSP: turn on reporting for a new policy, monitor the
violation reports and fix any bugs that turn up; when you're satisfied with its effect, start enforcing the new policy.</p>
<h3>Usage in the real world</h3>
<p>CSP 1 is quite usable in Chrome, Safari, and Firefox, but has very limited support in IE 10. CSP Level 2 has been
available in Chrome since version 40. You can see more at <a href="https://caniuse.com/?search=content%20security%20policy%20level%202">caniuse</a>.
Massive sites like Twitter and Facebook have deployed the header, and the standard is very much ready for you to start
deploying on your own sites.</p>
<h2>References</h2>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">SameOriginPolicy</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross Origing Resource Sharing - CORS</a></li>
<li><a href="https://fetch.spec.whatwg.org/#cors-safelisted-request-header">CORS Safelisted request headers</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#preflighted_requests">Pre-flight-requests</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream">Readable Streams</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Content Security Policy - CSP</a></li>
<li><a href="https://en.wikipedia.org/wiki/Cross-site_scripting">XSS-attacks</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/default-src">CSP-default-src directive</a></li>
<li><a href="https://www.w3.org/TR/CSP3/">CSP-Level 3 specification</a></li>
<li><a href="https://html.spec.whatwg.org/dev/origin.html#sandboxing">HTML5 Sandboxing Specification</a></li>
</ul></div><div class="MuiBox-root jss6"><hr class="MuiDivider-root"/></div><h6 class="MuiTypography-root MuiTypography-subtitle2 MuiTypography-colorTextSecondary">Published: <!-- -->2021-04-30</h6><h6 class="MuiTypography-root MuiTypography-subtitle2 MuiTypography-colorTextSecondary">Author: <!-- -->Henrik Grönvall</h6></div></div></div><div class="MuiBox-root jss8 jss7"><h6 class="MuiTypography-root MuiTypography-subtitle2 MuiTypography-gutterBottom">Henrik Grönvall</h6><div class="MuiBox-root jss9"><a class="MuiTypography-root MuiLink-root MuiLink-underlineHover MuiButtonBase-root MuiIconButton-root jss10 MuiTypography-colorPrimary" tabindex="0" role="button" aria-disabled="false" aria-label="github" href="https://github.com/HenrikGr" target="_blank" rel="noopener noreferrer"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .3a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.5 1 0-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8 0 3.2.9.8 1.3 1.9 1.3 3.2 0 4.6-2.8 5.6-5.5 5.9.5.4.9 1 .9 2.2v3.3c0 .3.1.7.8.6A12 12 0 0 0 12 .3"></path></svg></span></a><a class="MuiTypography-root MuiLink-root MuiLink-underlineHover MuiButtonBase-root MuiIconButton-root jss11 MuiTypography-colorPrimary" tabindex="0" role="button" aria-disabled="false" aria-label="email" href="mailto:hgc-ab@outlook.com" target="_blank" rel="noopener noreferrer"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"></path></svg></span></a></div><h6 class="MuiTypography-root MuiTypography-subtitle2 MuiTypography-alignRight">Copyright © <!-- -->2021<!-- --> <!-- -->Henrik Grönvall Consulting AB</h6></div><div role="presentation" class="jss12" style="transform:scale(0);visibility:hidden"><button class="MuiButtonBase-root MuiFab-root MuiFab-secondary" tabindex="0" type="button" aria-label="scroll back to top"><span class="MuiFab-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></span></button></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-152419885-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/articles/node-http-secorutiy/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-27cb774510f148c94f58.js"],"app":["/app-ab328917ee7b8a5b5eb3.js"],"component---src-pages-404-js":["/component---src-pages-404-js-071029e285e911a7bac5.js"],"component---src-pages-articles-js":["/component---src-pages-articles-js-478f57e4107808e2528a.js"],"component---src-pages-index-js":["/component---src-pages-index-js-3c7dcf7c7a8d894ce57a.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-f24eb426275ebbad4183.js"],"component---src-templates-about-page-template-js":["/component---src-templates-about-page-template-js-17f8568b49c8d18ab117.js"],"component---src-templates-article-page-template-js":["/component---src-templates-article-page-template-js-4aee4b756c530e8f4ae6.js"],"component---src-templates-articles-tags-template-js":["/component---src-templates-articles-tags-template-js-3fb675d6167759d3f49d.js"],"component---src-templates-project-page-template-js":["/component---src-templates-project-page-template-js-4be24b3796ec72a00a92.js"]};/*]]>*/</script><script src="/polyfill-27cb774510f148c94f58.js" nomodule=""></script><script src="/component---src-templates-article-page-template-js-4aee4b756c530e8f4ae6.js" async=""></script><script src="/875d5575f84d2db311b8feddedb7ed30b8fce884-8e0df0fbb1f2b518c4b4.js" async=""></script><script src="/commons-7366a34b018bd46c988c.js" async=""></script><script src="/app-ab328917ee7b8a5b5eb3.js" async=""></script><script src="/framework-a6306eaaf8346efc791c.js" async=""></script><script src="/webpack-runtime-3f45427426fd7161da8e.js" async=""></script></body></html>