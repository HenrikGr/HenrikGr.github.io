<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.f0e6320b25128c443eb7.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#eee;background:#272822;font-family:Roboto Mono,monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#363636}:not(pre)>code[class*=language-]{white-space:normal;border-radius:.2em;padding:.1em}pre[class*=language-]{overflow:auto;position:relative;margin:.5em 0;padding:1.25em 1em}.language-css>code,.language-sass>code,.language-scss>code{color:#fd9170}[class*=language-] .namespace{opacity:.7}.token.atrule{color:#c792ea}.token.attr-name{color:#ffcb6b}.token.attr-value,.token.attribute{color:#a5e844}.token.boolean{color:#c792ea}.token.builtin{color:#ffcb6b}.token.cdata,.token.char{color:#80cbc4}.token.class{color:#ffcb6b}.token.class-name{color:#f2ff00}.token.comment{color:#616161}.token.constant{color:#c792ea}.token.deleted{color:#f66}.token.doctype{color:#616161}.token.entity{color:#f66}.token.function{color:#c792ea}.token.hexcode{color:#f2ff00}.token.id,.token.important{color:#c792ea;font-weight:700}.token.inserted{color:#80cbc4}.token.keyword{color:#c792ea}.token.number{color:#fd9170}.token.operator{color:#89ddff}.token.prolog{color:#616161}.token.property{color:#80cbc4}.token.pseudo-class,.token.pseudo-element{color:#a5e844}.token.punctuation{color:#89ddff}.token.regex{color:#f2ff00}.token.selector{color:#f66}.token.string{color:#a5e844}.token.symbol{color:#c792ea}.token.tag{color:#f66}.token.unit{color:#fd9170}.token.url,.token.variable{color:#f66}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}h1{font-size:30px;line-height:1.167;letter-spacing:0}h1,h2{font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;margin-top:16px;margin-bottom:8px}h2{font-size:24px;line-height:1.235;letter-spacing:.00735em}h3{font-family:Roboto,Helvetica,Arial,sans-serif;font-size:18px;font-weight:500;line-height:1.334;letter-spacing:0;margin-top:16px;margin-bottom:8px}caption{font-size:.75rem;line-height:1.67;letter-spacing:.03333rem;margin:0}caption,p{font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400}p{line-height:1.43;letter-spacing:.01071em;margin-top:0;margin-bottom:16px}li,p{font-size:.875rem}li{font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.5;letter-spacing:.01786rem;margin:8px 0 0}blockquote{margin:0 0 16px;padding:16px;border-left:5px solid #d84315;background-color:#272822;color:#fff}blockquote>p{margin:0}a{color:#ff9800}.gatsby-highlight{background-color:#272822;border-radius:.4em;margin:1.6em 0;padding:1em;overflow:auto}.gatsby-highlight pre[class*=language-].line-numbers{padding:0 0 0 2.8em;overflow:initial}.gatsby-highlight-code-line{background-color:#000;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid #111}</style><meta name="generator" content="Gatsby 3.1.0"/><title data-react-helmet="true">Henrik Grönvall Consulting AB - Domain Driven Design - The Domain Layer</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="In the last article I described the implementation differences between entity objects and value objects 
where the most significant difference is that entity…"/><meta data-react-helmet="true" name="keywords" content="JavaScript,React,Node.js,HTML,CSS,Cloud"/><style id="jss-server-side">.jss4{padding-top:16px;padding-bottom:16px}.jss5{padding-top:16px;padding-left:16px;padding-right:16px;padding-bottom:16px}.jss6{padding-top:8px;padding-bottom:8px}.MuiTypography-root{margin:0}.MuiTypography-body2{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.43;letter-spacing:.01071em}.MuiTypography-body1{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.5;letter-spacing:.00938em}.MuiTypography-caption{font-size:.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.66;letter-spacing:.03333em}.MuiTypography-button{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.75;letter-spacing:.02857em;text-transform:uppercase}.MuiTypography-h1{font-size:6rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1.167;letter-spacing:-.01562em}.MuiTypography-h2{font-size:3.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:300;line-height:1.2;letter-spacing:-.00833em}.MuiTypography-h3{font-size:3rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.167;letter-spacing:0}.MuiTypography-h4{font-size:2.125rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.235;letter-spacing:.00735em}.MuiTypography-h5{font-size:1.5rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.334;letter-spacing:0}.MuiTypography-h6{font-size:1.25rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.6;letter-spacing:.0075em}.MuiTypography-subtitle1{font-size:1rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:1.75;letter-spacing:.00938em}.MuiTypography-subtitle2{font-size:.875rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.57;letter-spacing:.00714em}.MuiTypography-overline{font-size:.75rem;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:400;line-height:2.66;letter-spacing:.08333em;text-transform:uppercase}.MuiTypography-srOnly{width:1px;height:1px;overflow:hidden;position:absolute}.MuiTypography-alignLeft{text-align:left}.MuiTypography-alignCenter{text-align:center}.MuiTypography-alignRight{text-align:right}.MuiTypography-alignJustify{text-align:justify}.MuiTypography-noWrap{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.MuiTypography-gutterBottom{margin-bottom:.35em}.MuiTypography-paragraph{margin-bottom:16px}.MuiTypography-colorInherit{color:inherit}.MuiTypography-colorPrimary{color:#3f51b5}.MuiTypography-colorSecondary{color:#f50057}.MuiTypography-colorTextPrimary{color:rgba(0,0,0,.87)}.MuiTypography-colorTextSecondary{color:rgba(0,0,0,.54)}.MuiTypography-colorError{color:#f44336}.MuiTypography-displayInline{display:inline}.MuiTypography-displayBlock{display:block}.MuiPaper-root{color:rgba(0,0,0,.87);transition:box-shadow .3s cubic-bezier(.4,0,.2,1) 0s;background-color:#fff}.MuiPaper-rounded{border-radius:4px}.MuiPaper-outlined{border:1px solid rgba(0,0,0,.12)}.MuiPaper-elevation0{box-shadow:none}.MuiPaper-elevation1{box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12)}.MuiPaper-elevation2{box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.MuiPaper-elevation3{box-shadow:0 3px 3px -2px rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 1px 8px 0 rgba(0,0,0,.12)}.MuiPaper-elevation4{box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)}.MuiPaper-elevation5{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 5px 8px 0 rgba(0,0,0,.14),0 1px 14px 0 rgba(0,0,0,.12)}.MuiPaper-elevation6{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12)}.MuiPaper-elevation7{box-shadow:0 4px 5px -2px rgba(0,0,0,.2),0 7px 10px 1px rgba(0,0,0,.14),0 2px 16px 1px rgba(0,0,0,.12)}.MuiPaper-elevation8{box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.MuiPaper-elevation9{box-shadow:0 5px 6px -3px rgba(0,0,0,.2),0 9px 12px 1px rgba(0,0,0,.14),0 3px 16px 2px rgba(0,0,0,.12)}.MuiPaper-elevation10{box-shadow:0 6px 6px -3px rgba(0,0,0,.2),0 10px 14px 1px rgba(0,0,0,.14),0 4px 18px 3px rgba(0,0,0,.12)}.MuiPaper-elevation11{box-shadow:0 6px 7px -4px rgba(0,0,0,.2),0 11px 15px 1px rgba(0,0,0,.14),0 4px 20px 3px rgba(0,0,0,.12)}.MuiPaper-elevation12{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 12px 17px 2px rgba(0,0,0,.14),0 5px 22px 4px rgba(0,0,0,.12)}.MuiPaper-elevation13{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 13px 19px 2px rgba(0,0,0,.14),0 5px 24px 4px rgba(0,0,0,.12)}.MuiPaper-elevation14{box-shadow:0 7px 9px -4px rgba(0,0,0,.2),0 14px 21px 2px rgba(0,0,0,.14),0 5px 26px 4px rgba(0,0,0,.12)}.MuiPaper-elevation15{box-shadow:0 8px 9px -5px rgba(0,0,0,.2),0 15px 22px 2px rgba(0,0,0,.14),0 6px 28px 5px rgba(0,0,0,.12)}.MuiPaper-elevation16{box-shadow:0 8px 10px -5px rgba(0,0,0,.2),0 16px 24px 2px rgba(0,0,0,.14),0 6px 30px 5px rgba(0,0,0,.12)}.MuiPaper-elevation17{box-shadow:0 8px 11px -5px rgba(0,0,0,.2),0 17px 26px 2px rgba(0,0,0,.14),0 6px 32px 5px rgba(0,0,0,.12)}.MuiPaper-elevation18{box-shadow:0 9px 11px -5px rgba(0,0,0,.2),0 18px 28px 2px rgba(0,0,0,.14),0 7px 34px 6px rgba(0,0,0,.12)}.MuiPaper-elevation19{box-shadow:0 9px 12px -6px rgba(0,0,0,.2),0 19px 29px 2px rgba(0,0,0,.14),0 7px 36px 6px rgba(0,0,0,.12)}.MuiPaper-elevation20{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 20px 31px 3px rgba(0,0,0,.14),0 8px 38px 7px rgba(0,0,0,.12)}.MuiPaper-elevation21{box-shadow:0 10px 13px -6px rgba(0,0,0,.2),0 21px 33px 3px rgba(0,0,0,.14),0 8px 40px 7px rgba(0,0,0,.12)}.MuiPaper-elevation22{box-shadow:0 10px 14px -6px rgba(0,0,0,.2),0 22px 35px 3px rgba(0,0,0,.14),0 8px 42px 7px rgba(0,0,0,.12)}.MuiPaper-elevation23{box-shadow:0 11px 14px -7px rgba(0,0,0,.2),0 23px 36px 3px rgba(0,0,0,.14),0 9px 44px 8px rgba(0,0,0,.12)}.MuiPaper-elevation24{box-shadow:0 11px 15px -7px rgba(0,0,0,.2),0 24px 38px 3px rgba(0,0,0,.14),0 9px 46px 8px rgba(0,0,0,.12)}.MuiAppBar-root{width:100%;display:flex;z-index:1100;box-sizing:border-box;flex-shrink:0;flex-direction:column}.MuiAppBar-positionFixed{top:0;left:auto;right:0;position:fixed}@media print{.MuiAppBar-positionFixed{position:absolute}}.MuiAppBar-positionAbsolute{top:0;left:auto;right:0;position:absolute}.MuiAppBar-positionSticky{top:0;left:auto;right:0;position:-webkit-sticky;position:sticky}.MuiAppBar-positionStatic{position:static}.MuiAppBar-positionRelative{position:relative}.MuiAppBar-colorDefault{color:rgba(0,0,0,.87);background-color:#f5f5f5}.MuiAppBar-colorPrimary{color:#fff;background-color:#3f51b5}.MuiAppBar-colorSecondary{color:#fff;background-color:#f50057}.MuiAppBar-colorInherit{color:inherit}.MuiAppBar-colorTransparent{color:inherit;background-color:transparent}.MuiToolbar-root{display:flex;position:relative;align-items:center}.MuiToolbar-gutters{padding-left:16px;padding-right:16px}@media (min-width:600px){.MuiToolbar-gutters{padding-left:24px;padding-right:24px}}.MuiToolbar-regular{min-height:56px}@media (min-width:0px) and (orientation:landscape){.MuiToolbar-regular{min-height:48px}}@media (min-width:600px){.MuiToolbar-regular{min-height:64px}}.MuiToolbar-dense{min-height:48px}.MuiButtonBase-root{color:inherit;border:0;cursor:pointer;margin:0;display:inline-flex;outline:0;padding:0;position:relative;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border-radius:0;vertical-align:middle;-moz-appearance:none;justify-content:center;text-decoration:none;background-color:transparent;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.MuiButtonBase-root::-moz-focus-inner{border-style:none}.MuiButtonBase-root.Mui-disabled{cursor:default;pointer-events:none}@media print{.MuiButtonBase-root{-webkit-print-color-adjust:exact;color-adjust:exact}}.MuiIconButton-root{flex:0 0 auto;color:rgba(0,0,0,.54);padding:12px;overflow:visible;font-size:1.5rem;text-align:center;transition:background-color 150ms cubic-bezier(.4,0,.2,1) 0s;border-radius:50%}.MuiIconButton-root:hover{background-color:rgba(0,0,0,.04)}.MuiIconButton-root.Mui-disabled{color:rgba(0,0,0,.26);background-color:transparent}@media (hover:none){.MuiIconButton-root:hover{background-color:transparent}}.MuiIconButton-edgeStart{margin-left:-12px}.MuiIconButton-sizeSmall.MuiIconButton-edgeStart{margin-left:-3px}.MuiIconButton-edgeEnd{margin-right:-12px}.MuiIconButton-sizeSmall.MuiIconButton-edgeEnd{margin-right:-3px}.MuiIconButton-colorInherit{color:inherit}.MuiIconButton-colorPrimary{color:#3f51b5}.MuiIconButton-colorPrimary:hover{background-color:rgba(63,81,181,.04)}@media (hover:none){.MuiIconButton-colorPrimary:hover{background-color:transparent}}.MuiIconButton-colorSecondary{color:#f50057}.MuiIconButton-colorSecondary:hover{background-color:rgba(245,0,87,.04)}@media (hover:none){.MuiIconButton-colorSecondary:hover{background-color:transparent}}.MuiIconButton-sizeSmall{padding:3px;font-size:1.125rem}.MuiIconButton-label{width:100%;display:flex;align-items:inherit;justify-content:inherit}.MuiSvgIcon-root{fill:currentColor;width:1em;height:1em;display:inline-block;font-size:1.5rem;transition:fill .2s cubic-bezier(.4,0,.2,1) 0s;flex-shrink:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.MuiSvgIcon-colorPrimary{color:#3f51b5}.MuiSvgIcon-colorSecondary{color:#f50057}.MuiSvgIcon-colorAction{color:rgba(0,0,0,.54)}.MuiSvgIcon-colorError{color:#f44336}.MuiSvgIcon-colorDisabled{color:rgba(0,0,0,.26)}.MuiSvgIcon-fontSizeInherit{font-size:inherit}.MuiSvgIcon-fontSizeSmall{font-size:1.25rem}.MuiSvgIcon-fontSizeLarge{font-size:2.1875rem}.MuiLink-underlineNone{text-decoration:none}.MuiLink-underlineHover{text-decoration:none}.MuiLink-underlineHover:hover{text-decoration:underline}.MuiLink-underlineAlways{text-decoration:underline}.MuiLink-button{border:0;cursor:pointer;margin:0;outline:0;padding:0;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;border-radius:0;vertical-align:middle;-moz-appearance:none;background-color:transparent;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.MuiLink-button::-moz-focus-inner{border-style:none}.MuiLink-button.Mui-focusVisible{outline:auto}.MuiFab-root{color:rgba(0,0,0,.87);width:56px;height:56px;padding:0;font-size:.875rem;min-width:0;box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12);box-sizing:border-box;min-height:36px;transition:background-color 250ms cubic-bezier(.4,0,.2,1) 0s,box-shadow 250ms cubic-bezier(.4,0,.2,1) 0s,border 250ms cubic-bezier(.4,0,.2,1) 0s;font-family:Roboto,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.75;border-radius:50%;letter-spacing:.02857em;text-transform:uppercase;background-color:#e0e0e0}.MuiFab-root:active{box-shadow:0 7px 8px -4px rgba(0,0,0,.2),0 12px 17px 2px rgba(0,0,0,.14),0 5px 22px 4px rgba(0,0,0,.12)}.MuiFab-root:hover{text-decoration:none;background-color:#d5d5d5}.MuiFab-root.Mui-focusVisible{box-shadow:0 3px 5px -1px rgba(0,0,0,.2),0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12)}.MuiFab-root.Mui-disabled{color:rgba(0,0,0,.26);box-shadow:none;background-color:rgba(0,0,0,.12)}@media (hover:none){.MuiFab-root:hover{background-color:#e0e0e0}}.MuiFab-root:hover.Mui-disabled{background-color:rgba(0,0,0,.12)}.MuiFab-label{width:100%;display:inherit;align-items:inherit;justify-content:inherit}.MuiFab-primary{color:#fff;background-color:#3f51b5}.MuiFab-primary:hover{background-color:#303f9f}@media (hover:none){.MuiFab-primary:hover{background-color:#3f51b5}}.MuiFab-secondary{color:#fff;background-color:#f50057}.MuiFab-secondary:hover{background-color:#c51162}@media (hover:none){.MuiFab-secondary:hover{background-color:#f50057}}.MuiFab-extended{width:auto;height:48px;padding:0 16px;min-width:48px;min-height:auto;border-radius:24px}.MuiFab-extended.MuiFab-sizeSmall{width:auto;height:34px;padding:0 8px;min-width:34px;border-radius:17px}.MuiFab-extended.MuiFab-sizeMedium{width:auto;height:40px;padding:0 16px;min-width:40px;border-radius:20px}.MuiFab-colorInherit{color:inherit}.MuiFab-sizeSmall{width:40px;height:40px}.MuiFab-sizeMedium{width:48px;height:48px}.MuiContainer-root{width:100%;display:block;box-sizing:border-box;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px}@media (min-width:600px){.MuiContainer-root{padding-left:24px;padding-right:24px}}.MuiContainer-disableGutters{padding-left:0;padding-right:0}@media (min-width:600px){.MuiContainer-fixed{max-width:600px}}@media (min-width:960px){.MuiContainer-fixed{max-width:960px}}@media (min-width:1280px){.MuiContainer-fixed{max-width:1280px}}@media (min-width:1920px){.MuiContainer-fixed{max-width:1920px}}@media (min-width:0px){.MuiContainer-maxWidthXs{max-width:444px}}@media (min-width:600px){.MuiContainer-maxWidthSm{max-width:600px}}@media (min-width:960px){.MuiContainer-maxWidthMd{max-width:960px}}@media (min-width:1280px){.MuiContainer-maxWidthLg{max-width:1280px}}@media (min-width:1920px){.MuiContainer-maxWidthXl{max-width:1920px}}.MuiCard-root{overflow:hidden}.jss12{right:16px;bottom:16px;position:fixed}.jss10{color:#fff;background-color:#3f51b5}.jss11{color:#fff;background-color:#3f51b5}.jss7{color:#fff;padding:48px 16px;margin-top:64px;background-color:#3f51b5}.MuiDivider-root{border:none;height:1px;margin:0;flex-shrink:0;background-color:rgba(0,0,0,.12)}.MuiDivider-absolute{left:0;width:100%;bottom:0;position:absolute}.MuiDivider-inset{margin-left:72px}.MuiDivider-light{background-color:rgba(0,0,0,.08)}.MuiDivider-middle{margin-left:16px;margin-right:16px}.MuiDivider-vertical{width:1px;height:100%}.MuiDivider-flexItem{height:auto;align-self:stretch}.MuiCardMedia-root{display:block;background-size:cover;background-repeat:no-repeat;background-position:center}.MuiCardMedia-media{width:100%}.MuiCardMedia-img{-o-object-fit:cover;object-fit:cover}.jss1{height:210px}.jss2{font-size:14px;padding-top:16px}.jss3{font-size:14px}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-c0cfe15c444bd8b3ae86.js"/><link as="script" rel="preload" href="/framework-1e55c686a5ba92cb754a.js"/><link as="script" rel="preload" href="/app-54847606ae3e240b4eec.js"/><link as="script" rel="preload" href="/commons-7366a34b018bd46c988c.js"/><link as="script" rel="preload" href="/875d5575f84d2db311b8feddedb7ed30b8fce884-550ed5cb8e4ee8e56024.js"/><link as="script" rel="preload" href="/component---src-templates-article-page-template-js-ebb5de386526c8ac11ca.js"/><link as="fetch" rel="preload" href="/page-data/articles/ddd-domain-layer/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4011214723.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="MuiPaper-root MuiAppBar-root MuiAppBar-positionFixed MuiAppBar-colorPrimary mui-fixed MuiPaper-elevation0"><div class="MuiToolbar-root MuiToolbar-regular MuiToolbar-gutters"><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-edgeStart" tabindex="0" type="button" aria-label="menu"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg></span></button><h6 class="MuiTypography-root MuiTypography-subtitle1 MuiTypography-colorInherit">Domain Driven Design - The Domain Layer</h6></div></header><div class="MuiToolbar-root MuiToolbar-regular MuiToolbar-gutters" id="back-to-top-anchor"></div><div class="MuiContainer-root MuiBox-root jss4 MuiContainer-maxWidthMd"><div class="MuiPaper-root MuiCard-root MuiPaper-elevation1 MuiPaper-rounded"><div class="MuiCardMedia-root jss1" style="background-image:url(&quot;https://source.unsplash.com/random?summer&quot;)"></div><div class="MuiBox-root jss5"><div><p>In the last article I described the implementation differences between entity objects and value objects
where the most significant difference is that entity objects have a lifespan are mutable and have
their own intrinsic identity based on a unique id. Value objects on the other hand, have no lifespan,
belongs to entity objects, have no id, are equal by their attributes, are immutable and thus
represent a snapshot of state. I also mentioned that these software artifacts is used in the
domain model and implement the business requirements defined by the UbiquitousLanguage.</p>
<h1>How do we define a domain model?</h1>
<p>Domain-Driven Design is about designing software based on models of the underlying domain. A model acts
as a UbiquitousLanguage to help communication between software developers and domain experts. It also
acts as the conceptual foundation for the design of the software itself - how it's broken down into
objects or functions. To be effective, a model needs to be unified - that is to be internally consistent
so that there are no contradictions within it.</p>
<p>Modelling a large domain can get hard quickly and building a single unified model is more difficult
the bigger organization. More people or groups of people leads to subtle different vocabularies and
different interpretation in different parts of an organization and modelling often end up in confusion.</p>
<p>Domain-Driven Design advocates through the strategic concept to divide up large systems into bounded
contexts, where each can have a unified model.</p>
<p>Bounded contexts have both unrelated concepts but also share concepts. Different contexts may have
completely different models of common concepts with mechanisms to map between these uncertain concepts
for integration.</p>
<p>To define a domain model it's therefore important to explicitly define the context within which a
model applies. In the Domain-Driven Design - the Context Map is designated as the primary tool used
to make context boundaries explicit.</p>
<h2>Software artifacts in domain models</h2>
<p>I have already mentioned entity objects and value objects as software artifacts commonly used in the
domain layer and will now touch other artifacts such as aggregates, domain services, and domain events.
All elements in the domain layer are only dependent on each other and actively avoid dependencies any
outer layers.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a08f37c2356b310f9e82ff80d84e579b/5a190/ddd-architecture-doman-layer.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 47.32142857142857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdUlEQVQoz32SS0/CQBSFuxFidINRUDHGlgYVBAqERwVK59EZKAtj3Bg3gLgQtv4WN27d+R/NcToIEYIsTm6aSb57zzk1CKGglMAnBCLgoG4BjXwazfwp3MI5JHHBGAdR75F8318q+qaULmckI4IRDQvQdkxYRzE8iAae7ihYLQs7uQPpN0AoA2cMg8EAYRhqrcPmwGgz5ZDdOjLJGGTbQdjJYdy/Am8V0XEuUDQTkIKBKuB4NMJ0OtVzcfUKkBAfXEjUbky4uRPUixY+Hg18vxt47RholG9QNvfA/JYGvkwmmM1mGA6HkFL+AwwUsPALVPPr2QA+DbwxAzUnj4q5D66Ake2w39d2I+tCiC2WVU52Kq4te8UU7qtxeFUbnrLsWAfoCa6LWxTS7Xa3lxKoUrxKBtljBarYaFUu4aq2r9O7allTL6Vr12wsZfW3CcBuSyjbhyhZCdTzZ+jRtsqOb7xmk+aW/0AZD3Q2QSDmGancVmHbgT+IMDgXDB/zFwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Architecture"
        title="Domain Layer"
        src="/static/a08f37c2356b310f9e82ff80d84e579b/5a190/ddd-architecture-doman-layer.png"
        srcset="/static/a08f37c2356b310f9e82ff80d84e579b/80b2d/ddd-architecture-doman-layer.png 224w,
/static/a08f37c2356b310f9e82ff80d84e579b/33b38/ddd-architecture-doman-layer.png 448w,
/static/a08f37c2356b310f9e82ff80d84e579b/5a190/ddd-architecture-doman-layer.png 800w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<h3>Aggregates</h3>
<p>Aggregate is a pattern in Domain-Driven Design. An aggregate is a cluster of domain objects that can
be treated as a single unit and will have one of its component objects be the aggregate root. Any
references from outside the aggregate should only go to the aggregate root. The root can thus ensure the
integrity of the aggregate as a whole.</p>
<p>Aggregates are the basic element of transfer of data storage - you request to load or save whole aggregates.
Transactions should not cross aggregate boundaries.</p>
<h3>Domain Events</h3>
<p>A domain event is, something that happened in the domain that you want other parts of the same domain
to be aware of. The notified parts usually react somehow to the events. An important benefit
of domain events is that side effects can be expressed explicitly.</p>
<p>The essence of a domain event is that you use it to capture things that can trigger a change to the
state of the application you are developing.</p>
<h3>Domain Service</h3>
<p>The domain service consist of methods that don’t really fit on a single entity or require access to the
application services. The domain service can also contain domain logic of its own and is as much part of
the domain model as entities and value objects.</p>
<h2>Register User - a use case to put it all together</h2>
<p>It's time for some code examples and when I have played with Domain-Driven Design concepts, in Typescript,
I have focused on user account as a domain or bounded context. Use cases is in my opinion a great method
to model and designing software. The challenge has been to map it into the software artifacts
of Domain-Driven Design.</p>
<h3>Business requirements</h3>
<p>The requirements of the use case "Register User" can be written like this.</p>
<h3>Objective</h3>
<p>The purpose of the use case is to allow anyone to register for the application and when done an email
verification should be sent to the registered email address with a verification token in a link for
the user to verify the registration.</p>
<h3>The business rules are</h3>
<p>A user who register to the application must enter;</p>
<ul>
<li>a username: must be at least 5 chars long and not longer than 15 chars,</li>
<li>a password: must be 6 to 20 characters and at least one numeric, one uppercase and one lowercase,</li>
<li>an email address: must be a valid email address form</li>
</ul>
<p>The user to be created must setting default values for other properties such as,</p>
<ul>
<li>scope = profile,</li>
<li>isEmailVerified = false,</li>
<li>isAdmin = false,</li>
<li>isDeleted = false.</li>
</ul>
<p>There must NOT be possible to overwrite an existing user. </p>
<ul>
<li>A user marked for deletion is still existing.</li>
<li>A user can only have one username and one email address.</li>
</ul>
<h3>External boundaries</h3>
<p>When the user account is created, the email verification services must be informed in order to send out
a verification email. The email verification system will in a soon future be replaced with a message
infrastructure.</p>
<h2>Register User - implementing the domain model</h2>
<p>Time to focus on the implementation of the domain model derived from the business requirements expressed in the use case
and, using Domain-Driven Design software artifacts.</p>
<p>In our use case, the aggregate root for the domain is the User object. The interface of the User will be expressed
as a Typescript interface and have the following shape;</p>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">IUserProps</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> UserName <span class="token comment">// Value object</span>
  email<span class="token operator">:</span> UserEmail  <span class="token comment">// Value object</span>
  credential<span class="token operator">?</span><span class="token operator">:</span> UserCredential <span class="token comment">// Value object</span>
  scope<span class="token operator">?</span><span class="token operator">:</span> UserScope
  isEmailVerified<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  isAdminUser<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  isDeleted<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>We know that username, password and email will be received as inputs to the use case and, they will be
implemented as value objects since they belong to the User object, the rest of the parameters will be set
with default values when creating the User object. The implementation of the value object UserName
can be seen below;</p>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ValueObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../core/domain/ValueObject'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Result <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../core/common/Result'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Guard <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../core/common/Guard'</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">IUserNameProps</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserName</span> <span class="token keyword">extends</span> <span class="token class-name">ValueObject<span class="token operator">&lt;</span>IUserNameProps<span class="token operator">></span></span> <span class="token punctuation">{</span>
  <span class="token comment">// Validation rules</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> maxLength<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">15</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> minLength<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">5</span>
  
  <span class="token keyword">private</span> <span class="token keyword">constructor</span><span class="token punctuation">(</span>props<span class="token operator">:</span> IUserNameProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// getter for the value</span>
  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>username
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * Factory method to create an instance and apply the validation rules
   * @param username The user name
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">create</span><span class="token punctuation">(</span>username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>UserName<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> minLengthResult <span class="token operator">=</span> Guard<span class="token punctuation">.</span><span class="token function">againstAtLeast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>minLength<span class="token punctuation">,</span> username<span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>minLengthResult<span class="token punctuation">.</span>isSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">fail</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserName<span class="token operator">></span></span></span><span class="token punctuation">(</span>minLengthResult<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> maxLengthResult <span class="token operator">=</span> Guard<span class="token punctuation">.</span><span class="token function">againstAtMost</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maxLength<span class="token punctuation">,</span> username<span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>maxLengthResult<span class="token punctuation">.</span>isSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">fail</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserName<span class="token operator">></span></span></span><span class="token punctuation">(</span>maxLengthResult<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">ok</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserName<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserName</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token operator">:</span> username<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Q) Why do I not inject the creation of the UserName object to the User object and perform the
validation there?</p>
<p>A) Single responsibility rule: validation rules belong to UserName and not User.</p>
<p>Q) Why do I implement a factory method and using a private constructor to create a value object?</p>
<p>A) I have chosen this approach in order to enforce object creation rules, when using the "new" keyword to
create objects there is not in my view an elegant way to enforce validation rules. Throwing errors
in the constructor can be done but is not elegant and sometimes the creation of the stored value
(expressed as props) may need an async function and that is not possible/recommended. For example, I do not store the plain
text of the password in the UserCredential value object - instead I store the salted and hashed
password. Salt and hash a password should in Node.js be implemented as an async function.</p>
<p>The other objects - UserCredential and UserEmail - follows the same implementation design and, I do not provide code
examples, they do provide a public static factory method and uses private constructors as well. </p>
<p>As you can see, this way we can implement the business requirements from the use case
description;</p>
<ul>
<li>a username, must be at least 5 chars long and not longer than 15 chars,</li>
<li>a password, must be 6 to 20 characters and at least one numeric, one uppercase and one lowercase,</li>
<li>an email address, must be a valid email address form</li>
</ul>
<p>Now we head over to the implementation of the User object; </p>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Result <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../core/common/Result'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AggregateRoot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../core/domain/AggregateRoot'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UniqueEntityID <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../core/domain/UniqueEntityID'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> UserDomainEvent<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./events/UserDomainEvent'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserName <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./userName'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserEmail <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./userEmail'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserCredential <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./UserCredential'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserScope <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./userScope'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserId <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./UserId'</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">AggregateRoot<span class="token operator">&lt;</span>IUserProps<span class="token operator">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">constructor</span><span class="token punctuation">(</span>props<span class="token operator">:</span> IUserProps<span class="token punctuation">,</span> id<span class="token operator">?</span><span class="token operator">:</span> UniqueEntityID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">get</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> UniqueEntityID <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_id
  <span class="token punctuation">}</span>
  
  <span class="token keyword">get</span> <span class="token function">username</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> UserName <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>username
  <span class="token punctuation">}</span>
  
  <span class="token keyword">get</span> <span class="token function">email</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> UserEmail <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>email
  <span class="token punctuation">}</span>
  
  <span class="token keyword">get</span> <span class="token function">credential</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> UserCredential <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>UserCredential<span class="token operator">></span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>credential
  <span class="token punctuation">}</span>
  
  <span class="token keyword">get</span> <span class="token function">isEmailVerified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isEmailVerified
  <span class="token punctuation">}</span>
  
  <span class="token keyword">set</span> <span class="token function">isEmailVerified</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isEmailVerified <span class="token operator">=</span> value
    <span class="token comment">// Create a domain event if email has been verified</span>
    <span class="token keyword">const</span> userEmailverified <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDomainEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">'META: Changed isEmailVerified'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addDomainEvent</span><span class="token punctuation">(</span>userEmailverified<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">get</span> <span class="token function">isAdminUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isAdminUser
  <span class="token punctuation">}</span>
  
  <span class="token keyword">get</span> <span class="token function">isDeleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isDeleted
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Factory method creating the User entity
   * @param {IUserProps} props
   * @param {UniqueEntityID} id
   * @return {Result&lt;User>}
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">create</span><span class="token punctuation">(</span>props<span class="token operator">:</span> IUserProps<span class="token punctuation">,</span> id<span class="token operator">?</span><span class="token operator">:</span> UniqueEntityID<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>User<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment">// Creates a new User object and sets default values</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span>
        <span class="token operator">...</span>props<span class="token punctuation">,</span>
        scope<span class="token operator">:</span> props<span class="token punctuation">.</span>scope <span class="token operator">?</span> props<span class="token punctuation">.</span>scope <span class="token operator">:</span> UserScope<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'profile'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        isDeleted<span class="token operator">:</span> props<span class="token punctuation">.</span>isDeleted <span class="token operator">?</span> props<span class="token punctuation">.</span>isDeleted <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isEmailVerified<span class="token operator">:</span> props<span class="token punctuation">.</span>isEmailVerified <span class="token operator">?</span> props<span class="token punctuation">.</span>isEmailVerified <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        isAdminUser<span class="token operator">:</span> props<span class="token punctuation">.</span>isAdminUser <span class="token operator">?</span> props<span class="token punctuation">.</span>isAdminUser <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      id
    <span class="token punctuation">)</span>
    <span class="token comment">// if a new user entity was created - create a domain event</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> userCreated <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDomainEvent</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">'META: new user created'</span><span class="token punctuation">)</span>
      user<span class="token punctuation">.</span><span class="token function">addDomainEvent</span><span class="token punctuation">(</span>userCreated<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">ok</span><span class="token generic class-name"><span class="token operator">&lt;</span>User<span class="token operator">></span></span></span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Q) Why does the User inherits from AggregateRoot?</p>
<p>A) The AggregateRoot implements logic for the domain service to handle domain events. Our User entity object now
inherits from the AggregateRoot and thus have access to creating, dispatching and deleting  domain events and as you
can se we have implemented to create a new domain event when a new User object is created. The logic to detect if we
are creating a new User is based on the id parameter passed into the factory function. If we do not get an id it is a
new user, we would assume if we get an id it comes from an existing User object, that we have loaded in from a database.</p>
<p>You can also note we are setting default values to the other properties when creating the User object. Just as
requirements told us.</p>
<p>If you are curious about the implementation of the abstract AggregateRoot class and, the DomainEvent class,
here they are:</p>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Entity <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./Entity'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> IDomainEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./events/IDomainEvent'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> DomainEvents <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./events/DomainEvents'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UniqueEntityID <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./UniqueEntityID'</span>

<span class="token keyword">export</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AggregateRoot<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token keyword">extends</span> <span class="token class-name">Entity<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">protected</span> _domainEvents<span class="token operator">:</span> IDomainEvent<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">get</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> UniqueEntityID <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_id
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">domainEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> IDomainEvent<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_domainEvents
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token function">addDomainEvent</span><span class="token punctuation">(</span>domainEvent<span class="token operator">:</span> IDomainEvent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_domainEvents<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>domainEvent<span class="token punctuation">)</span>
    DomainEvents<span class="token punctuation">.</span><span class="token function">markAggregateForDispatch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token function">dispatchDomainEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    DomainEvents<span class="token punctuation">.</span><span class="token function">dispatchEventsForAggregate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token function">clearEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_domainEvents<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_domainEvents<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> IDomainEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../../core/domain/events/IDomainEvent'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UniqueEntityID <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../../core/domain/UniqueEntityID'</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserDomainEvent</span> <span class="token keyword">implements</span> <span class="token class-name">IDomainEvent</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> dateTimeOccurred<span class="token operator">:</span> Date
  <span class="token keyword">public</span> meta<span class="token operator">:</span> <span class="token builtin">any</span>
  <span class="token keyword">public</span> aggregateId<span class="token operator">:</span> UniqueEntityID
  <span class="token keyword">public</span> eventType<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'UserDomainEvent'</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>aggregateId<span class="token operator">:</span>UniqueEntityID <span class="token punctuation">,</span> meta<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dateTimeOccurred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>aggregateId <span class="token operator">=</span> aggregateId
    <span class="token keyword">this</span><span class="token punctuation">.</span>meta <span class="token operator">=</span> meta
    <span class="token keyword">this</span><span class="token punctuation">.</span>eventType <span class="token operator">=</span> <span class="token keyword">type</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The aggregate root inherits from the abstract class Entity and, the User object is extended to contain the methods for
domain events from the AggregateRoot.</p>
<p>So far we have implemented the domain logic to the use case of register a user based on the business
requirements but what about the use case implementation?</p>
<h2>Register User - implementing the use case</h2>
<p>Now we are thinking about the application layer in Domain-Driven Design where use cases belong. If we compare Uncle Bobs
Clean Architecture with Domain-Driven Design, the application layer in Domain-Driven Design roughly correspond
to the application business rules layer in Clean Architecture, which implements use case or user stories. The
Domain-Driven Design terminology is trying to make a distinction between application services which depend on
the domain layer, and domain services, which take part in implementing the domain logic.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/294531728121a702107f04296e5c8419/5a190/ddd-architecture-application-layer-first.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 47.32142857142857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoElEQVQoz32SS0/bQBSFZwOoajdUFFqoKhIs2hISnKAkGPKYGY9t8iBgIUHVSFRJN93zW9iwZdf/WH2MJyQkCHVxNZ7XN+fcY6GURmuFVIo4MuigSL2wxVFhk6D4hUQFhKFB2X2tNVJK2u32pOx3Ns/Ws/2sRAZTDhbR8HPkPyxzGdf5ea4Jq7t460skso62UG3Pdbtd+v0+vV7PVZIkM2hWIjuktCFp19hZXyZp+HSbe4w63zAnJZr+NqXcKqexsaok11dX/B6P+XVz42o4HJKmqXURThQqJTFxQnU/R7D3iVopz/0Pwb87wZ+moF7ep7z9FiMb1qLifDBgNBo56ODsDGMMcRzPbE+AkQUWn4B2/DsW8CC4DQVVv0Al984BpQWmFxdOZWa30+k4u9P+LVq2ffI2VpzlVmmD9HCF1qFHy1r28++dZekuPocy37uZwmkokQ2lVdlh96MFVTxOKl8JbNrft97Yx47co/pJxUvI/Fws/jYR4fEBZW+Ng/wqtcJnTnXDJTy9qF6BLgCd5TloaCLX5CiK3ah0+AL2f+AjyxQ4xGSwMWkAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Architecture"
        title="Application Layer"
        src="/static/294531728121a702107f04296e5c8419/5a190/ddd-architecture-application-layer-first.png"
        srcset="/static/294531728121a702107f04296e5c8419/80b2d/ddd-architecture-application-layer-first.png 224w,
/static/294531728121a702107f04296e5c8419/33b38/ddd-architecture-application-layer-first.png 448w,
/static/294531728121a702107f04296e5c8419/5a190/ddd-architecture-application-layer-first.png 800w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>There is so many layers I manage to write in one article though. I will go through the use case implementation
in more details in the next article but below you can se the code for my implementation of the "create user"
use case.</p>
<p>As your already can see in the code, more software artifacts shows up and needs a detailed explanation. I
will try to describe, Repository, DTO, Mappers and the use case associated Response type and how they fit into
the application layer of Domain-Driven Design.</p>
<p>Example code of the use case implementation:</p>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> AppError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../../core/common/AppError'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Result<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../../core/common/Result'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> DomainEvents <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../../core/domain/events/DomainEvents'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UseCase <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../../core/domain/UseCase'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> IUserRepo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../repos/userRepo'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ICreateUserDTO <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./CreateUserDTO'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CreateUserErrors <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./CreateUserErrors'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CreateUserResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./CreateUserResponse'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../domain/User'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserName <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../domain/userName'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserEmail <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../domain/userEmail'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserCredential <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../domain/UserCredential'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserDomainEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../domain/events/UserDomainEvent'</span>

<span class="token comment">/**
 * Implements use case logic
 * @class
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CreateUser</span> <span class="token keyword">implements</span> <span class="token class-name">UseCase<span class="token operator">&lt;</span>ICreateUserDTO<span class="token punctuation">,</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>CreateUserResponse<span class="token operator">>></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> userRepo<span class="token operator">:</span> IUserRepo

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>userRepo<span class="token operator">:</span> IUserRepo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>userRepo <span class="token operator">=</span> userRepo
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Implementation of the use case
   * @param createUserDTO
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">executeCommand</span><span class="token punctuation">(</span>createUserDTO<span class="token operator">:</span> ICreateUserDTO<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>CreateUserResponse<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> user<span class="token operator">:</span> User
    <span class="token keyword">let</span> username<span class="token operator">:</span> UserName
    <span class="token keyword">let</span> credential<span class="token operator">:</span> UserCredential
    <span class="token keyword">let</span> email<span class="token operator">:</span> UserEmail

    <span class="token keyword">try</span> <span class="token punctuation">{</span>

      <span class="token comment">// Create value objects from DTO</span>
      <span class="token keyword">const</span> isValidUserName <span class="token operator">=</span> UserName<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createUserDTO<span class="token punctuation">.</span>username<span class="token punctuation">)</span>
      <span class="token keyword">const</span> isValidUserCredential <span class="token operator">=</span> <span class="token keyword">await</span> UserCredential<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createUserDTO<span class="token punctuation">.</span>password<span class="token punctuation">)</span>
      <span class="token keyword">const</span> isValidUserEmail <span class="token operator">=</span> UserEmail<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createUserDTO<span class="token punctuation">.</span>email<span class="token punctuation">)</span>
      <span class="token keyword">const</span> combinedResult <span class="token operator">=</span> Result<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span><span class="token punctuation">[</span>isValidUserName<span class="token punctuation">,</span> isValidUserCredential<span class="token punctuation">,</span> isValidUserEmail<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>combinedResult<span class="token punctuation">.</span>isSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CreateUserErrors</span><span class="token punctuation">.</span><span class="token function">ValidationError</span><span class="token punctuation">(</span>combinedResult<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> CreateUserResponse
      <span class="token punctuation">}</span>

      <span class="token comment">// The value objects where ok - get them</span>
      username <span class="token operator">=</span> isValidUserName<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      credential <span class="token operator">=</span> isValidUserCredential<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      email <span class="token operator">=</span> isValidUserEmail<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token comment">// Check if user already exist and if so validate according to our business rules</span>
      <span class="token comment">// Pay attention to that we are searching for an existing user with username and email</span>
      <span class="token comment">// combined in a unique index in the database.</span>
      <span class="token keyword">let</span> foundUser<span class="token operator">:</span> User <span class="token operator">=</span> <span class="token operator">&lt;</span>User<span class="token operator">></span><span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepo<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> email<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>foundUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        <span class="token comment">// The user existed but was marked for deletion</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>foundUser<span class="token punctuation">.</span>isDeleted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CreateUserErrors</span><span class="token punctuation">.</span><span class="token function">UserIsMarkedForDeletion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> CreateUserResponse
        <span class="token punctuation">}</span>
        
        <span class="token comment">// The user existed but the username is already taken</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>foundUser<span class="token punctuation">.</span>username<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CreateUserErrors</span><span class="token punctuation">.</span><span class="token function">UsernameTaken</span><span class="token punctuation">(</span>username<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> CreateUserResponse
        <span class="token punctuation">}</span>

        <span class="token comment">// The user existed but the email address existed</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>foundUser<span class="token punctuation">.</span>email<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CreateUserErrors</span><span class="token punctuation">.</span><span class="token function">EmailAlreadyExists</span><span class="token punctuation">(</span>email<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> CreateUserResponse
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// The User does not exists - create a User object</span>
      <span class="token comment">// We know as well the factory method of the User object creates a domain event</span>
      <span class="token keyword">const</span> isValidUser <span class="token operator">=</span> User<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> username<span class="token punctuation">,</span> email<span class="token punctuation">,</span> credential <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isValidUser<span class="token punctuation">.</span>isFailure<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">left</span><span class="token punctuation">(</span>Result<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">fail</span><span class="token generic class-name"><span class="token operator">&lt;</span>User<span class="token operator">></span></span></span><span class="token punctuation">(</span>isValidUser<span class="token punctuation">.</span>error<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> CreateUserResponse
      <span class="token punctuation">}</span>

      <span class="token comment">// The User object is valid and contains consisted data and a domain event.</span>
      <span class="token comment">// The user object is an aggregate root and only aggregate roots are allowed to</span>
      <span class="token comment">// contain domain events. Domain events should never cross the transaction boundary </span>
      user <span class="token operator">=</span> isValidUser<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token comment">// Save the user</span>
      <span class="token comment">// We are passing an aggregate root to the repository</span>
      <span class="token keyword">const</span> isSaved <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userRepo<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

      <span class="token comment">// If user where saved properly - dispatch all events for the aggregate root</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isSaved<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        DomainEvents<span class="token punctuation">.</span><span class="token function">dispatchEventsForAggregate</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// We could clear the created domain event, but we may also create </span>
        <span class="token comment">// another domain even informing that an attempt to create a user</span>
        <span class="token comment">// failed</span>
        user<span class="token punctuation">.</span><span class="token function">clearDomainEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Return void since the use case is a command</span>
      <span class="token keyword">return</span> <span class="token function">right</span><span class="token punctuation">(</span>Result<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">ok</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AppError</span><span class="token punctuation">.</span><span class="token function">UnexpectedError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> CreateUserResponse
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Summary</h2>
<p>In this article I have continue put a focus on the ubiquitous language and how important it is to be able
to model business requirements with a focus on bounded context in order to design great unified domain models.</p>
<p>I have described how to implement the domain layer using common DDD software artifacts based on business
requirements expressed in use case format.</p>
<p>I have touched how to use tools such as "use cases or user stories" to cover business requirements and mentioned
context mapping as another tool to use. </p>
<p>I have also shared my experimental code and hope you can be merciful for any obvious bugs or mistakes.</p>
<p>Bear in mind I'm doing this on my spare time, and unfortunately I have plenty of it and doing it all alone
with no other to brainstorm with, which is not satisfying. </p>
<p>I love it though and apart from learning DDD I'm also learning Typescript and refreshing my mental thinking. </p>
<p>However, If you think I can add value to your business, do not hesitate to contact me. I would love communicating
with other peers and solve real problems.</p>
<p>Happy coding. :-)</p></div><div class="MuiBox-root jss6"><hr class="MuiDivider-root"/></div><h6 class="MuiTypography-root MuiTypography-subtitle2 MuiTypography-colorTextSecondary">Published: <!-- -->2021-03-01</h6><h6 class="MuiTypography-root MuiTypography-subtitle2 MuiTypography-colorTextSecondary">PublishedBy: <!-- -->Henrik Grönvall</h6></div></div></div><div class="MuiBox-root jss8 jss7"><h6 class="MuiTypography-root MuiTypography-subtitle2 MuiTypography-gutterBottom">Henrik Grönvall</h6><div class="MuiBox-root jss9"><a class="MuiTypography-root MuiLink-root MuiLink-underlineHover MuiButtonBase-root MuiIconButton-root jss10 MuiTypography-colorPrimary" tabindex="0" role="button" aria-disabled="false" aria-label="github" href="https://github.com/HenrikGr" target="_blank" rel="noopener noreferrer"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .3a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.5 1 0-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8 0 3.2.9.8 1.3 1.9 1.3 3.2 0 4.6-2.8 5.6-5.5 5.9.5.4.9 1 .9 2.2v3.3c0 .3.1.7.8.6A12 12 0 0 0 12 .3"></path></svg></span></a><a class="MuiTypography-root MuiLink-root MuiLink-underlineHover MuiButtonBase-root MuiIconButton-root jss11 MuiTypography-colorPrimary" tabindex="0" role="button" aria-disabled="false" aria-label="email" href="mailto:hgc-ab@outlook.com" target="_blank" rel="noopener noreferrer"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"></path></svg></span></a></div><h6 class="MuiTypography-root MuiTypography-subtitle2 MuiTypography-alignRight">Copyright © <!-- -->2021<!-- --> <!-- -->Henrik Grönvall Consulting AB</h6></div><div role="presentation" class="jss12" style="transform:scale(0);visibility:hidden"><button class="MuiButtonBase-root MuiFab-root MuiFab-secondary" tabindex="0" type="button" aria-label="scroll back to top"><span class="MuiFab-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></span></button></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-152419885-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/articles/ddd-domain-layer/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-7b669ef4db2dfbd0e5b6.js"],"app":["/app-54847606ae3e240b4eec.js"],"component---src-pages-404-js":["/component---src-pages-404-js-071029e285e911a7bac5.js"],"component---src-pages-articles-js":["/component---src-pages-articles-js-478f57e4107808e2528a.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a1aeabc6a26af542929b.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-f3f7e91543f3486f2978.js"],"component---src-templates-about-page-template-js":["/component---src-templates-about-page-template-js-1af314a48b8dc011fd11.js"],"component---src-templates-article-page-template-js":["/component---src-templates-article-page-template-js-ebb5de386526c8ac11ca.js"],"component---src-templates-articles-tags-template-js":["/component---src-templates-articles-tags-template-js-3fb675d6167759d3f49d.js"],"component---src-templates-project-page-template-js":["/component---src-templates-project-page-template-js-8959331364e361f3172d.js"]};/*]]>*/</script><script src="/polyfill-7b669ef4db2dfbd0e5b6.js" nomodule=""></script><script src="/component---src-templates-article-page-template-js-ebb5de386526c8ac11ca.js" async=""></script><script src="/875d5575f84d2db311b8feddedb7ed30b8fce884-550ed5cb8e4ee8e56024.js" async=""></script><script src="/commons-7366a34b018bd46c988c.js" async=""></script><script src="/app-54847606ae3e240b4eec.js" async=""></script><script src="/framework-1e55c686a5ba92cb754a.js" async=""></script><script src="/webpack-runtime-c0cfe15c444bd8b3ae86.js" async=""></script></body></html>